<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataK9 Studio - Your IDE for Data Quality</title>

    <!--
        DataK9 Studio - Professional IDE for Data Validation Configuration
        Author: Daniel Edge
        Version: 1.0.0

        This is a comprehensive IDE-style interface for creating and modifying
        YAML configuration files for the DataK9 data validation framework.

        Features:
        - Visual configuration builder with 22 validation types
        - Live YAML editor with syntax highlighting (Monaco Editor)
        - Two-way sync between UI and YAML
        - Validation catalog with comprehensive documentation
        - Import/Export YAML configurations
        - Project wizard for guided setup
        - Context-sensitive help system
        - Auto-save to localStorage
        - Professional dark theme inspired by VS Code
    -->

    <style>
        /* ============================================================================
           DataK9 Studio Brand Colors and Theme
           ============================================================================

           Primary Brand Identity:
           - Name: DataK9 Studio (K9 = canine/dog theme)
           - Tagline: "Your IDE for data quality"
           - Theme: Professional dark IDE with dog/guardian metaphor

           Color Palette:
           - K9 Blue: #4A90E2 (primary action color, representing trust/reliability)
           - Guard Orange: #FF8C42 (accent color, representing vigilance/alerts)
           - Dark Slate: #1E1E1E (main background, IDE standard)
           - Panel Gray: #252526 (panel backgrounds)
           - Border Gray: #3E3E42 (borders and dividers)
           - Text White: #D4D4D4 (primary text)
           - Text Muted: #858585 (secondary text)
           - Success Green: #4EC9B0 (validation success)
           - Warning Yellow: #DCDCAA (warnings)
           - Error Red: #F48771 (errors)
        */

        :root {
            /* Primary Brand Colors */
            --k9-blue: #4A90E2;
            --k9-blue-hover: #5BA3F5;
            --k9-blue-dark: #3A7BC8;
            --guard-orange: #FF8C42;
            --guard-orange-hover: #FFA366;

            /* Background Colors */
            --bg-dark: #1E1E1E;
            --bg-panel: #252526;
            --bg-panel-hover: #2A2D2E;
            --bg-input: #3C3C3C;
            --bg-sidebar: #252526;

            /* Border Colors */
            --border-main: #3E3E42;
            --border-focus: var(--k9-blue);

            /* Text Colors */
            --text-primary: #D4D4D4;
            --text-secondary: #858585;
            --text-muted: #6A6A6A;

            /* Status Colors */
            --status-success: #4EC9B0;
            --status-warning: #DCDCAA;
            --status-error: #F48771;
            --status-info: var(--k9-blue);

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            /* Typography */
            --font-sans: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            --font-mono: 'Consolas', 'SF Mono', 'Monaco', 'Courier New', monospace;

            /* Layout Dimensions */
            --sidebar-width: 280px;
            --help-panel-width: 320px;
            --menu-height: 35px;
            --bottom-panel-height: 200px;
        }

        /* ============================================================================
           Global Reset and Base Styles
           ============================================================================ */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow: hidden;
            font-size: 14px;
            line-height: 1.6;
        }

        /* ============================================================================
           Main Layout Structure
           ============================================================================

           Layout hierarchy:
           - app-container: Full viewport container
             - menu-bar: Top menu (File, Edit, View, Help)
             - app-body: Main content area
               - sidebar: Left navigation panel
               - main-area: Center editor area
                 - editor-container: Visual builder and YAML editor
               - help-panel: Right context help
             - bottom-panel: Footer with export and status
        */

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* ============================================================================
           Menu Bar
           ============================================================================ */

        .menu-bar {
            height: var(--menu-height);
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-main);
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-md);
            gap: var(--spacing-md);
            flex-shrink: 0;
        }

        .menu-item {
            color: var(--text-primary);
            padding: 4px 12px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background-color: var(--bg-panel-hover);
        }

        .app-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-title .logo {
            font-size: 16px;
        }

        /* ============================================================================
           App Body (Main Content Area)
           ============================================================================ */

        .app-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ============================================================================
           Sidebar (Left Navigation Panel)
           ============================================================================

           The sidebar displays:
           - Project tree showing files and their validations
           - Add File button
           - File management controls
        */

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-main);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-main);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h3 {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-sm);
        }

        /* File Tree Styles */
        .file-item {
            margin-bottom: var(--spacing-sm);
            border: 1px solid var(--border-main);
            border-radius: 4px;
            background-color: var(--bg-panel);
            overflow: hidden;
        }

        .file-header {
            padding: var(--spacing-sm) var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .file-header:hover {
            background-color: var(--bg-panel-hover);
        }

        .file-header.selected {
            background-color: var(--k9-blue);
            color: white;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex: 1;
        }

        .file-icon {
            font-size: 16px;
        }

        .file-name {
            font-size: 13px;
            font-weight: 500;
        }

        .file-format-badge {
            font-size: 10px;
            padding: 2px 6px;
            background-color: var(--k9-blue);
            color: white;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .file-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .file-action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 12px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .file-action-btn:hover {
            opacity: 1;
            color: var(--text-primary);
        }

        .validations-list {
            padding: var(--spacing-sm);
            background-color: var(--bg-dark);
            display: none;
        }

        .file-item.expanded .validations-list {
            display: block;
        }

        .validation-item {
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            background-color: var(--bg-panel);
            border-left: 3px solid var(--k9-blue);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .validation-item:hover {
            background-color: var(--bg-panel-hover);
            transform: translateX(4px);
        }

        .validation-item.selected {
            background-color: var(--k9-blue);
            color: white;
        }

        .validation-item.error-severity {
            border-left-color: var(--status-error);
        }

        .validation-item.warning-severity {
            border-left-color: var(--status-warning);
        }

        .validation-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex: 1;
        }

        .validation-icon {
            font-size: 14px;
        }

        .validation-name {
            font-size: 12px;
        }

        .severity-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.error {
            background-color: var(--status-error);
            color: white;
        }

        .severity-badge.warning {
            background-color: var(--status-warning);
            color: var(--bg-dark);
        }

        /* ============================================================================
           Main Editor Area
           ============================================================================ */

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0; /* Fix for flex children overflow */
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0; /* Fix for flex children overflow */
        }

        /* Editor Split View */
        .editor-split {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0; /* Fix for flex children overflow */
        }

        .visual-editor {
            flex: 1;
            background-color: var(--bg-dark);
            overflow-y: auto;
            padding: var(--spacing-lg);
            border-right: 1px solid var(--border-main);
            min-height: 0; /* Fix for flex overflow */
        }

        .yaml-editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-dark);
            min-height: 0; /* Fix for flex overflow */
        }

        .yaml-editor-header {
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-main);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .yaml-editor-header h3 {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .yaml-editor-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            min-height: 0; /* Fix for flex overflow */
        }

        /* Monaco Editor Container */
        #monaco-editor {
            width: 100%;
            height: 100%;
        }

        /* Fallback Textarea (if Monaco fails to load) */
        #yaml-textarea {
            width: 100%;
            height: 100%;
            background-color: var(--bg-input);
            color: var(--text-primary);
            border: none;
            padding: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 13px;
            line-height: 1.6;
            resize: none;
            outline: none;
        }

        /* ============================================================================
           Help Panel (Right Sidebar)
           ============================================================================ */

        .help-panel {
            width: var(--help-panel-width);
            background-color: var(--bg-sidebar);
            border-left: 1px solid var(--border-main);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .help-panel-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-main);
        }

        .help-panel-header h3 {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .help-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
        }

        .help-section {
            margin-bottom: var(--spacing-lg);
        }

        .help-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--k9-blue);
            margin-bottom: var(--spacing-sm);
        }

        .help-section p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
        }

        .help-section ul {
            list-style: none;
            padding-left: 0;
        }

        .help-section li {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 4px 0;
            padding-left: 16px;
            position: relative;
        }

        .help-section li:before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: var(--k9-blue);
        }

        .help-code {
            background-color: var(--bg-input);
            padding: var(--spacing-sm);
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--status-success);
            margin: var(--spacing-sm) 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* ============================================================================
           Bottom Panel
           ============================================================================ */

        .bottom-panel {
            height: auto;
            background-color: var(--bg-panel);
            border-top: 1px solid var(--border-main);
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
        }

        .bottom-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .validation-summary {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .bottom-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* ============================================================================
           Buttons
           ============================================================================ */

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-sans);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--k9-blue) 0%, var(--k9-blue-dark) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--k9-blue-hover) 0%, var(--k9-blue) 100%);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-secondary);
            border: 2px solid var(--border-main);
        }

        .btn-secondary:hover {
            background-color: var(--bg-panel-hover);
            color: var(--text-primary);
            border-color: var(--text-secondary);
        }

        .btn-danger {
            background-color: var(--status-error);
            color: white;
        }

        .btn-danger:hover {
            background-color: #FF6B56;
            box-shadow: 0 4px 12px rgba(244, 135, 113, 0.4);
            transform: translateY(-1px);
        }

        .btn-success {
            background-color: var(--status-success);
            color: white;
        }

        .btn-success:hover {
            background-color: #5FD9C0;
            box-shadow: 0 4px 12px rgba(78, 201, 176, 0.4);
            transform: translateY(-1px);
        }

        .btn-small {
            padding: 4px 10px;
            font-size: 11px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ============================================================================
           Form Elements
           ============================================================================ */

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .form-label-required:after {
            content: " *";
            color: var(--status-error);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            background-color: var(--bg-input);
            color: var(--text-primary);
            border: 2px solid var(--border-main);
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 13px;
            font-family: var(--font-sans);
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: var(--font-mono);
            font-size: 12px;
        }

        .form-help {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: var(--spacing-xs);
            font-style: italic;
        }

        .form-checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .form-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        /* ============================================================================
           Cards and Panels
           ============================================================================ */

        .card {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-main);
            border-radius: 6px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        .card-header {
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-main);
        }

        .card-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .card-body {
            /* Default styles applied to card content */
        }

        /* ============================================================================
           Modal Dialogs
           ============================================================================ */

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-main);
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-main);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background-color: var(--bg-panel-hover);
            color: var(--text-primary);
        }

        .modal-body {
            padding: var(--spacing-lg);
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-main);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        /* ============================================================================
           Wizard Styles
           ============================================================================ */

        .wizard-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-xl);
            gap: var(--spacing-md);
        }

        .wizard-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .wizard-step.active {
            opacity: 1;
        }

        .wizard-step.completed {
            opacity: 0.7;
        }

        .wizard-step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--bg-input);
            border: 2px solid var(--border-main);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .wizard-step.active .wizard-step-number {
            background-color: var(--k9-blue);
            border-color: var(--k9-blue);
            color: white;
        }

        .wizard-step.completed .wizard-step-number {
            background-color: var(--status-success);
            border-color: var(--status-success);
            color: white;
        }

        .wizard-step-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .wizard-connector {
            width: 40px;
            height: 2px;
            background-color: var(--border-main);
            margin-top: -20px;
        }

        .wizard-step.completed + .wizard-connector {
            background-color: var(--status-success);
        }

        .wizard-content {
            min-height: 300px;
        }

        /* ============================================================================
           Validation Catalog
           ============================================================================ */

        .catalog-search {
            margin-bottom: var(--spacing-md);
        }

        .catalog-categories {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .category-filter {
            padding: 6px 12px;
            background-color: var(--bg-input);
            border: 1px solid var(--border-main);
            border-radius: 20px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-filter:hover,
        .category-filter.active {
            background-color: var(--k9-blue);
            border-color: var(--k9-blue);
            color: white;
        }

        .validation-catalog-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-sm);
        }

        .validation-catalog-item {
            padding: var(--spacing-md);
            background-color: var(--bg-panel);
            border: 1px solid var(--border-main);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .validation-catalog-item:hover {
            border-color: var(--k9-blue);
            background-color: var(--bg-panel-hover);
            transform: translateX(4px);
        }

        .validation-catalog-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
        }

        .validation-catalog-icon {
            font-size: 18px;
        }

        .validation-catalog-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .validation-catalog-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .validation-catalog-category {
            display: inline-block;
            font-size: 10px;
            padding: 2px 8px;
            background-color: var(--bg-input);
            color: var(--text-secondary);
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* ============================================================================
           Welcome Screen
           ============================================================================ */

        .welcome-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: var(--spacing-xl);
        }

        .welcome-content {
            text-align: center;
            max-width: 600px;
        }

        .welcome-logo {
            font-size: 64px;
            margin-bottom: var(--spacing-lg);
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }

        .welcome-tagline {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xl);
            font-style: italic;
        }

        .welcome-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-xl);
        }

        .welcome-features {
            margin-top: var(--spacing-xl);
            text-align: left;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .welcome-feature {
            padding: var(--spacing-md);
            background-color: var(--bg-panel);
            border: 1px solid var(--border-main);
            border-radius: 6px;
        }

        .welcome-feature h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--k9-blue);
            margin-bottom: var(--spacing-xs);
        }

        .welcome-feature p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* ============================================================================
           Tooltips
           ============================================================================ */

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-input);
            color: var(--text-primary);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 11px;
            border: 1px solid var(--border-main);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* ============================================================================
           Loading Indicator
           ============================================================================ */

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-main);
            border-top-color: var(--k9-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============================================================================
           Resizable Panels System
           ============================================================================

           This section implements drag-to-resize functionality for all panels:
           - Resize handles placed between panels
           - Visual feedback on hover and active states
           - Smooth transitions and cursor changes
           - Min/max constraints enforced via JavaScript
        */

        /* Resize handle base styles */
        .resize-handle {
            position: absolute;
            z-index: 100;
            background-color: transparent;
            transition: background-color 0.2s, opacity 0.2s;
        }

        .resize-handle:hover {
            background-color: var(--k9-blue);
            opacity: 0.3;
        }

        .resize-handle.resizing {
            background-color: var(--k9-blue);
            opacity: 0.5;
        }

        /* Vertical resize handles (left-right dragging) */
        .resize-handle-vertical {
            top: 0;
            bottom: 0;
            width: 5px;
            cursor: col-resize;
        }

        /* Horizontal resize handles (up-down dragging) */
        .resize-handle-horizontal {
            left: 0;
            right: 0;
            height: 5px;
            cursor: row-resize;
        }

        /* Sidebar resize handle - positioned on right edge of sidebar */
        .resize-handle-sidebar {
            right: -3px;
        }

        /* Help panel resize handle - positioned on left edge of help panel */
        .resize-handle-help {
            left: -3px;
        }

        /* Bottom panel resize handle - positioned on top edge */
        .resize-handle-bottom {
            top: -3px;
        }

        /* YAML split resize handle - positioned between visual and YAML editors */
        .resize-handle-split {
            width: 5px;
            background-color: var(--border-main);
            cursor: col-resize;
            transition: background-color 0.2s;
            position: relative;
            flex-shrink: 0;
        }

        .resize-handle-split:hover {
            background-color: var(--k9-blue);
        }

        .resize-handle-split.resizing {
            background-color: var(--k9-blue);
        }

        /* ============================================================================
           Collapsible Panels System
           ============================================================================

           Collapse/expand functionality with smooth animations:
           - Collapse buttons in panel headers
           - Smooth width/height transitions
           - Chevron icon rotation animations
           - Collapsed state shows thin bar with expand button
        */

        /* Collapse button styling */
        .collapse-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 3px;
        }

        .collapse-btn:hover {
            background-color: var(--bg-panel-hover);
            color: var(--k9-blue);
        }

        .collapse-btn:focus {
            outline: 2px solid var(--k9-blue);
            outline-offset: 2px;
        }

        /* Chevron icon rotation animation */
        .collapse-icon {
            transition: transform 0.3s ease;
            display: inline-block;
        }

        /* Panel transition animations */
        .sidebar,
        .help-panel,
        .bottom-panel {
            transition: width 0.3s ease, height 0.3s ease, min-width 0.3s ease, min-height 0.3s ease;
            position: relative;
        }

        /* Collapsed states */
        .sidebar.collapsed {
            min-width: 40px !important;
            width: 40px !important;
        }

        .sidebar.collapsed .sidebar-content,
        .sidebar.collapsed .sidebar-header h3,
        .sidebar.collapsed .sidebar-header button {
            display: none;
        }

        .sidebar.collapsed .collapse-icon {
            transform: rotate(180deg);
        }

        .help-panel.collapsed {
            min-width: 40px !important;
            width: 40px !important;
        }

        .help-panel.collapsed .help-panel-content,
        .help-panel.collapsed .help-panel-header h3 {
            display: none;
        }

        .help-panel.collapsed .collapse-icon {
            transform: rotate(180deg);
        }

        .bottom-panel.collapsed {
            min-height: 35px !important;
            height: 35px !important;
        }

        .bottom-panel.collapsed .bottom-left,
        .bottom-panel.collapsed .bottom-right {
            display: none;
        }

        .bottom-panel.collapsed .collapse-icon {
            transform: rotate(180deg);
        }

        /* Collapsed panel bars */
        .collapsed-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background-color: var(--bg-panel);
            border: 1px solid var(--border-main);
        }

        /* Update panel headers to include collapse button */
        .sidebar-header,
        .help-panel-header {
            position: relative;
        }

        .panel-header-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        /* Bottom panel with collapse button */
        .bottom-panel-header {
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px;
            z-index: 10;
        }

        /* ============================================================================
           Mobile Responsive Design
           ============================================================================

           Comprehensive responsive layouts for mobile, tablet, and desktop:
           - Breakpoints: < 768px (mobile), 768-1024px (tablet), > 1024px (desktop)
           - Mobile: Stacked layout, drawer sidebar, modal help
           - Tablet: Two-column layout, collapsible panels
           - Desktop: Full three-column layout
        */

        /* Mobile hamburger menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            padding: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 4px;
        }

        .mobile-menu-btn:hover {
            background-color: var(--bg-panel-hover);
        }

        /* Mobile editor tabs */
        .mobile-editor-tabs {
            display: none;
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-main);
            flex-shrink: 0; /* Don't let tabs shrink */
        }

        .mobile-tab-buttons {
            display: flex;
            padding: 0;
        }

        .mobile-tab-btn {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 12px 16px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .mobile-tab-btn:hover {
            background-color: var(--bg-panel-hover);
            color: var(--text-primary);
        }

        .mobile-tab-btn.active {
            color: var(--k9-blue);
            border-bottom-color: var(--k9-blue);
        }

        /* Sidebar drawer overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* Tablet (768px - 1024px) */
        @media (max-width: 1024px) and (min-width: 769px) {
            :root {
                --sidebar-width: 240px;
                --help-panel-width: 280px;
            }

            .help-panel {
                /* Keep help panel but make it collapsible */
            }
        }

        /* Mobile (< 768px) */
        @media (max-width: 768px) {
            /* Show mobile menu button */
            .mobile-menu-btn {
                display: block;
            }

            /* Show mobile editor tabs */
            .mobile-editor-tabs {
                display: block;
            }

            /* Sidebar becomes drawer */
            .sidebar {
                position: fixed;
                top: var(--menu-height);
                left: -100%;
                bottom: 0;
                width: 280px !important;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
            }

            .sidebar.mobile-open {
                left: 0;
                width: 280px !important;
                min-width: 280px !important;
            }

            /* Show sidebar content when mobile drawer is open, even if collapsed on desktop */
            .sidebar.mobile-open .sidebar-content {
                display: block !important;
            }

            .sidebar.mobile-open .sidebar-header {
                display: flex !important;
            }

            .sidebar.mobile-open .sidebar-header h3,
            .sidebar.mobile-open .sidebar-header button {
                display: inline-block !important;
            }

            .sidebar.mobile-open .collapse-icon {
                transform: none !important;
            }

            /* Hide help panel on mobile, show as modal when needed */
            .help-panel {
                position: fixed;
                top: var(--menu-height);
                right: -100%;
                bottom: 0;
                width: 100% !important;
                max-width: 400px;
                z-index: 1000;
                transition: right 0.3s ease;
                box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);
            }

            .help-panel.mobile-open {
                right: 0;
                width: 300px !important;
                min-width: 300px !important;
            }

            /* Show help panel content when mobile drawer is open, even if collapsed on desktop */
            .help-panel.mobile-open .help-content {
                display: block !important;
            }

            .help-panel.mobile-open .help-header {
                display: flex !important;
            }

            .help-panel.mobile-open .help-header h3,
            .help-panel.mobile-open .help-header button {
                display: inline-block !important;
            }

            .help-panel.mobile-open .collapse-icon {
                transform: none !important;
            }

            /* Stack editor panels vertically */
            .editor-split {
                flex-direction: column;
            }

            /* Visual and YAML editors toggle visibility */
            .visual-editor,
            .yaml-editor-panel {
                flex: 1 1 100%; /* Allow full flex growth */
                min-height: 0; /* Fix for flex overflow */
                width: 100%;
                display: none;
            }

            .visual-editor.mobile-active {
                display: block;
                overflow-y: auto; /* Ensure scrolling works */
            }

            .yaml-editor-panel.mobile-active {
                display: flex;
                overflow: hidden; /* Monaco editor handles its own scrolling */
            }

            /* Bottom panel always collapsed on mobile */
            .bottom-panel {
                min-height: 35px !important;
                height: 35px !important;
            }

            .bottom-panel .bottom-left,
            .bottom-panel .bottom-right {
                display: none;
            }

            .bottom-panel.mobile-expanded {
                min-height: auto !important;
                height: auto !important;
            }

            .bottom-panel.mobile-expanded .bottom-left,
            .bottom-panel.mobile-expanded .bottom-right {
                display: flex;
            }

            /* Welcome screen features stack */
            .welcome-features {
                grid-template-columns: 1fr;
            }

            /* Touch-friendly sizing */
            .btn {
                min-height: 44px;
                padding: 12px 16px;
            }

            .file-header,
            .validation-item {
                min-height: 44px;
            }

            /* Hide resize handles on mobile */
            .resize-handle {
                display: none;
            }
        }

        /* Responsive Adjustments (keeping original for compatibility) */
        @media (max-width: 1024px) {
            :root {
                --sidebar-width: 240px;
                --help-panel-width: 280px;
            }
        }

        /* ============================================================================
           Utility Classes
           ============================================================================ */

        .hidden {
            display: none !important;
        }

        .text-muted {
            color: var(--text-muted);
        }

        .text-error {
            color: var(--status-error);
        }

        .text-success {
            color: var(--status-success);
        }

        .text-warning {
            color: var(--status-warning);
        }

        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: var(--spacing-xs); }
        .mb-2 { margin-bottom: var(--spacing-sm); }
        .mb-3 { margin-bottom: var(--spacing-md); }
        .mb-4 { margin-bottom: var(--spacing-lg); }

        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: var(--spacing-xs); }
        .mt-2 { margin-top: var(--spacing-sm); }
        .mt-3 { margin-top: var(--spacing-md); }
        .mt-4 { margin-top: var(--spacing-lg); }

        /* ============================================================================
           Drag and Drop Styles
           ============================================================================

           These styles support drag and drop reordering for both validation items
           and file items within the project tree. Visual feedback includes:
           - Drag handles with cursor changes
           - Opacity changes during drag
           - Border indicators for drop zones
           - Smooth transitions for all state changes
        */

        .validation-drag-handle,
        .file-drag-handle {
            cursor: grab;
            color: var(--text-secondary);
            padding: 4px 8px;
            font-size: 14px;
            user-select: none;
            display: inline-flex;
            align-items: center;
            transition: color 0.2s;
        }

        .validation-drag-handle:hover,
        .file-drag-handle:hover {
            color: var(--k9-blue);
        }

        .validation-drag-handle:active,
        .file-drag-handle:active {
            cursor: grabbing;
        }

        /* Validation item transitions for smooth drag interactions */
        .validation-item {
            transition: all 0.2s ease;
            position: relative;
        }

        /* Visual feedback during drag operation */
        .validation-item.dragging,
        .file-item.dragging {
            opacity: 0.5;
            background-color: var(--bg-panel-hover);
        }

        /* Drop zone indicators - show where item will be dropped */
        .validation-item.drag-over-top {
            border-top: 2px solid var(--k9-blue);
            margin-top: 2px;
        }

        .validation-item.drag-over-bottom {
            border-bottom: 2px solid var(--k9-blue);
            margin-bottom: 2px;
        }

        .file-item.drag-over-top {
            border-top: 2px solid var(--k9-blue);
            margin-top: 2px;
        }

        .file-item.drag-over-bottom {
            border-bottom: 2px solid var(--k9-blue);
            margin-bottom: 2px;
        }

        /* Animation for newly duplicated validations - pulse effect */
        .validation-item.just-duplicated {
            animation: duplicatePulse 0.6s ease;
        }

        @keyframes duplicatePulse {
            0%, 100% {
                background-color: transparent;
            }
            50% {
                background-color: rgba(74, 144, 226, 0.2);
            }
        }

        /* ============================================================================
           Context Menu Styles
           ============================================================================

           Right-click context menu for validation items providing quick access to:
           - Move up/down actions
           - Duplicate validation
           - Edit validation
           - Delete validation
        */

        .context-menu {
            position: fixed;
            background-color: var(--bg-panel);
            border: 1px solid var(--border-main);
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            min-width: 180px;
            padding: 4px 0;
            animation: contextMenuFadeIn 0.15s ease;
        }

        @keyframes contextMenuFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 13px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: var(--bg-panel-hover);
        }

        .context-menu-item.danger {
            color: var(--status-error);
        }

        .context-menu-item.disabled {
            color: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .context-menu-item.disabled:hover {
            background-color: transparent;
        }

        .context-menu-divider {
            height: 1px;
            background-color: var(--border-main);
            margin: 4px 0;
        }

        /* ============================================================================
           Touch Support for Mobile
           ============================================================================

           Enhanced touch targets and feedback for mobile drag operations
        */

        @media (max-width: 768px) {
            /* Larger touch targets for mobile */
            .validation-drag-handle,
            .file-drag-handle {
                padding: 12px;
                font-size: 18px;
            }

            /* Ensure duplicate button is large enough for touch */
            .file-action-btn {
                padding: 8px;
                font-size: 14px;
            }
        }

        /* ============================================================================
           Additional Action Button Styles
           ============================================================================

           Styles for the duplicate button and other validation item actions
        */

        .validation-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .validation-item:hover .validation-actions {
            opacity: 1;
        }

        .validation-action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 12px;
            opacity: 0.7;
            transition: opacity 0.2s, color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .validation-action-btn:hover {
            opacity: 1;
            color: var(--text-primary);
        }

        .validation-action-btn.duplicate-btn:hover {
            color: var(--k9-blue);
        }

        .validation-action-btn.delete-btn:hover {
            color: var(--status-error);
        }
    </style>
</head>
<body>
    <!-- ============================================================================
         Application Container
         ============================================================================ -->
    <div class="app-container">

        <!-- Menu Bar -->
        <div class="menu-bar">
            <!-- Mobile hamburger menu button - hidden on desktop -->
            <button class="mobile-menu-btn" onclick="panelManager.toggleMobileSidebar()"
                    aria-label="Toggle sidebar" title="Toggle sidebar">
                â˜°
            </button>

            <div class="menu-item" onclick="app.showMenu('file')">File</div>
            <div class="menu-item" onclick="app.showMenu('edit')">Edit</div>
            <div class="menu-item" onclick="app.showMenu('view')">View</div>
            <div class="menu-item" onclick="app.showMenu('help')">Help</div>
            <div class="app-title">
                <span class="logo">ðŸ•</span>
                <span>DataK9 Studio - Your IDE for Data Quality</span>
            </div>
        </div>

        <!-- App Body -->
        <div class="app-body">

            <!-- Left Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="panel-header-title">
                        <h3>Project Files</h3>
                        <button class="collapse-btn" onclick="panelManager.togglePanel('sidebar')"
                                aria-label="Collapse sidebar (Ctrl+B)" title="Collapse sidebar (Ctrl+B)">
                            <span class="collapse-icon">â—€</span>
                        </button>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="app.addFile()">
                        + Add File
                    </button>
                </div>
                <div class="sidebar-content" id="file-tree">
                    <!-- File tree will be rendered here -->
                </div>
                <!-- Resize handle for sidebar -->
                <div class="resize-handle resize-handle-vertical resize-handle-sidebar"
                     data-panel="sidebar"
                     aria-label="Resize sidebar"></div>
            </div>

            <!-- Main Editor Area -->
            <div class="main-area">
                <div class="editor-container">

                    <!-- Welcome Screen (shown when no project) -->
                    <div id="welcome-screen" class="welcome-screen">
                        <div class="welcome-content">
                            <div class="welcome-logo">ðŸ•</div>
                            <h1 class="welcome-title">DataK9 Studio</h1>
                            <p class="welcome-tagline">Your IDE for Data Quality</p>
                            <div class="welcome-actions">
                                <button class="btn btn-primary" onclick="app.startNewProject()">
                                    ðŸš€ New Project
                                </button>
                                <button class="btn btn-secondary" onclick="app.openImportDialog()">
                                    ðŸ“‚ Import YAML
                                </button>
                                <button class="btn btn-secondary" onclick="app.openCatalog()">
                                    ðŸ“š Browse Validations
                                </button>
                            </div>
                            <div class="welcome-features">
                                <div class="welcome-feature">
                                    <h4>ðŸŽ¨ Visual Builder</h4>
                                    <p>Build validation rules with an intuitive visual interface</p>
                                </div>
                                <div class="welcome-feature">
                                    <h4>ðŸ’» YAML Editor</h4>
                                    <p>Edit configurations directly with syntax highlighting</p>
                                </div>
                                <div class="welcome-feature">
                                    <h4>ðŸ”„ Two-Way Sync</h4>
                                    <p>Changes sync automatically between UI and YAML</p>
                                </div>
                                <div class="welcome-feature">
                                    <h4>ðŸ“¦ 22 Validation Types</h4>
                                    <p>Comprehensive library of production-tested validators</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Editor Tabs - shown only on mobile -->
                    <div class="mobile-editor-tabs" id="mobile-editor-tabs">
                        <div class="mobile-tab-buttons">
                            <button class="mobile-tab-btn active" data-tab="visual"
                                    onclick="panelManager.switchMobileTab('visual')">
                                Visual
                            </button>
                            <button class="mobile-tab-btn" data-tab="yaml"
                                    onclick="panelManager.switchMobileTab('yaml')">
                                YAML
                            </button>
                        </div>
                    </div>

                    <!-- Editor Split View (hidden initially) -->
                    <div id="editor-view" class="editor-split hidden">

                        <!-- Visual Editor -->
                        <div class="visual-editor mobile-active" id="visual-editor">
                            <!-- Visual configuration builder will be rendered here -->
                        </div>

                        <!-- Resize handle for split view -->
                        <div class="resize-handle-split" id="split-resize-handle"
                             aria-label="Resize editor split"></div>

                        <!-- YAML Editor -->
                        <div class="yaml-editor-panel" id="yaml-editor-panel">
                            <div class="yaml-editor-header">
                                <h3>YAML Configuration</h3>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-small btn-secondary" onclick="app.copyYAML()">
                                        ðŸ“‹ Copy
                                    </button>
                                    <button class="btn btn-small btn-secondary" onclick="app.formatYAML()">
                                        âœ¨ Format
                                    </button>
                                </div>
                            </div>
                            <div class="yaml-editor-content">
                                <!-- Monaco Editor will be initialized here -->
                                <div id="monaco-editor"></div>
                                <!-- Fallback textarea if Monaco doesn't load -->
                                <textarea id="yaml-textarea" class="hidden"></textarea>
                            </div>
                        </div>

                    </div>

                </div>
            </div>

            <!-- Right Help Panel -->
            <div class="help-panel" id="help-panel">
                <!-- Resize handle for help panel -->
                <div class="resize-handle resize-handle-vertical resize-handle-help"
                     data-panel="help-panel"
                     aria-label="Resize help panel"></div>

                <div class="help-panel-header">
                    <div class="panel-header-title">
                        <h3>Help & Documentation</h3>
                        <button class="collapse-btn" onclick="panelManager.togglePanel('help-panel')"
                                aria-label="Collapse help panel (Ctrl+H)" title="Collapse help panel (Ctrl+H)">
                            <span class="collapse-icon">â–¶</span>
                        </button>
                    </div>
                </div>
                <div class="help-panel-content" id="help-content">
                    <div class="help-section">
                        <h4>Welcome to DataK9 Studio</h4>
                        <p>Your professional IDE for building data validation configurations.</p>
                        <p>Start by creating a new project or importing an existing YAML configuration.</p>
                    </div>
                    <div class="help-section">
                        <h4>Quick Tips</h4>
                        <ul>
                            <li>Use ERROR severity for critical data requirements</li>
                            <li>Use WARNING severity for data quality issues</li>
                            <li>All validations support conditional execution</li>
                            <li>Changes are auto-saved to localStorage</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4>Keyboard Shortcuts</h4>
                        <ul>
                            <li>Ctrl+S - Save configuration</li>
                            <li>Ctrl+N - New project</li>
                            <li>Ctrl+O - Import YAML</li>
                            <li>Ctrl+E - Export YAML</li>
                            <li>Ctrl+B - Toggle sidebar</li>
                            <li>Ctrl+H - Toggle help panel</li>
                            <li>Ctrl+J - Toggle bottom panel</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

        <!-- Bottom Panel -->
        <div class="bottom-panel" id="bottom-panel">
            <!-- Resize handle for bottom panel -->
            <div class="resize-handle resize-handle-horizontal resize-handle-bottom"
                 data-panel="bottom-panel"
                 aria-label="Resize bottom panel"></div>

            <!-- Collapse button for bottom panel -->
            <div class="bottom-panel-header">
                <button class="collapse-btn" onclick="panelManager.togglePanel('bottom-panel')"
                        aria-label="Collapse bottom panel (Ctrl+J)" title="Collapse bottom panel (Ctrl+J)">
                    <span class="collapse-icon">â–²</span>
                </button>
            </div>

            <div class="bottom-left">
                <span class="validation-summary" id="validation-summary">
                    No project loaded
                </span>
            </div>
            <div class="bottom-right">
                <button class="btn btn-secondary btn-small" onclick="app.showAbout()">
                    â„¹ï¸ About
                </button>
                <button class="btn btn-success btn-small" onclick="app.exportYAML()">
                    ðŸ’¾ Export YAML
                </button>
            </div>
        </div>

        <!-- Sidebar overlay for mobile (tap to close) -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="panelManager.closeMobilePanels()"></div>

    </div>

    <!-- ============================================================================
         Modal Dialogs
         ============================================================================ -->

    <!-- New Project Wizard Modal -->
    <div id="new-project-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>New Validation Project</h2>
                <button class="modal-close" onclick="app.closeModal('new-project-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Wizard steps indicator -->
                <div class="wizard-steps">
                    <div class="wizard-step active" data-step="1">
                        <div class="wizard-step-number">1</div>
                        <div class="wizard-step-label">Project Info</div>
                    </div>
                    <div class="wizard-connector"></div>
                    <div class="wizard-step" data-step="2">
                        <div class="wizard-step-number">2</div>
                        <div class="wizard-step-label">Settings</div>
                    </div>
                    <div class="wizard-connector"></div>
                    <div class="wizard-step" data-step="3">
                        <div class="wizard-step-number">3</div>
                        <div class="wizard-step-label">First File</div>
                    </div>
                </div>

                <!-- Wizard content -->
                <div class="wizard-content">
                    <!-- Step 1: Project Info -->
                    <div id="wizard-step-1" class="wizard-step-content">
                        <div class="form-group">
                            <label class="form-label form-label-required">Project Name</label>
                            <input type="text" class="form-input" id="wizard-project-name"
                                   placeholder="My Data Validation Project">
                            <div class="form-help">A descriptive name for your validation project</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" id="wizard-project-description"
                                      placeholder="Optional description of what this validation project does"></textarea>
                        </div>
                    </div>

                    <!-- Step 2: Settings -->
                    <div id="wizard-step-2" class="wizard-step-content hidden">
                        <div class="form-group">
                            <label class="form-label">Chunk Size</label>
                            <input type="number" class="form-input" id="wizard-chunk-size" value="50000">
                            <div class="form-help">Number of rows to process at once (default: 50000)</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Sample Failures</label>
                            <input type="number" class="form-input" id="wizard-max-failures" value="100">
                            <div class="form-help">Maximum failures to collect before stopping (default: 100)</div>
                        </div>
                        <div class="form-group">
                            <div class="form-checkbox-group">
                                <input type="checkbox" class="form-checkbox" id="wizard-fail-error" checked>
                                <label class="form-label mb-0">Fail on ERROR severity</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-checkbox-group">
                                <input type="checkbox" class="form-checkbox" id="wizard-fail-warning">
                                <label class="form-label mb-0">Fail on WARNING severity</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Log Level</label>
                            <select class="form-select" id="wizard-log-level">
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO" selected>INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                            </select>
                        </div>
                    </div>

                    <!-- Step 3: First File -->
                    <div id="wizard-step-3" class="wizard-step-content hidden">
                        <div class="form-group">
                            <label class="form-label form-label-required">File Name</label>
                            <input type="text" class="form-input" id="wizard-file-name"
                                   placeholder="customer_data">
                            <div class="form-help">A logical name for this file (e.g., "customer_data")</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label form-label-required">File Path</label>
                            <input type="text" class="form-input" id="wizard-file-path"
                                   placeholder="data/customers.csv">
                            <div class="form-help">Path to the file to validate</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label form-label-required">File Format</label>
                            <select class="form-select" id="wizard-file-format">
                                <option value="csv">CSV</option>
                                <option value="excel">Excel</option>
                                <option value="json">JSON</option>
                                <option value="parquet">Parquet</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="wizard-back-btn" onclick="app.wizardBack()" style="display: none;">
                    â† Back
                </button>
                <button class="btn btn-primary" id="wizard-next-btn" onclick="app.wizardNext()">
                    Next â†’
                </button>
                <button class="btn btn-success" id="wizard-finish-btn" onclick="app.wizardFinish()" style="display: none;">
                    âœ“ Create Project
                </button>
            </div>
        </div>
    </div>

    <!-- Import YAML Modal -->
    <div id="import-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Import YAML Configuration</h2>
                <button class="modal-close" onclick="app.closeModal('import-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Paste your YAML configuration below:</label>
                    <textarea class="form-textarea" id="import-yaml-text"
                              placeholder="validation_job:
  name: 'My Validation'
  description: 'Description here'

settings:
  chunk_size: 50000

files:
  - name: 'file1'
    path: 'data/file.csv'
    format: 'csv'
    validations: []" style="min-height: 300px;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('import-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="app.importYAML()">Import</button>
            </div>
        </div>
    </div>

    <!-- Validation Catalog Modal -->
    <div id="catalog-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Validation Catalog</h2>
                <button class="modal-close" onclick="app.closeModal('catalog-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="catalog-search">
                    <input type="text" class="form-input" id="catalog-search"
                           placeholder="Search validations..."
                           oninput="app.filterCatalog()">
                </div>
                <div class="catalog-categories" id="catalog-categories">
                    <!-- Category filters will be rendered here -->
                </div>
                <div class="validation-catalog-list" id="catalog-list">
                    <!-- Validation catalog items will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('catalog-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Validation Modal -->
    <div id="add-validation-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Add Validation</h2>
                <button class="modal-close" onclick="app.closeModal('add-validation-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="catalog-search">
                    <input type="text" class="form-input" id="add-validation-search"
                           placeholder="Search validations..."
                           oninput="app.filterAddValidation()">
                </div>
                <div class="catalog-categories" id="add-validation-categories">
                    <!-- Category filters will be rendered here -->
                </div>
                <div class="validation-catalog-list" id="add-validation-list">
                    <!-- Validation catalog items will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('add-validation-modal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Validation Modal -->
    <div id="edit-validation-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="edit-validation-title">Edit Validation</h2>
                <button class="modal-close" onclick="app.closeModal('edit-validation-modal')">&times;</button>
            </div>
            <div class="modal-body" id="edit-validation-content">
                <!-- Validation form will be rendered here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="app.deleteValidation()">Delete</button>
                <button class="btn btn-secondary" onclick="app.closeModal('edit-validation-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveValidation()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add File Modal -->
    <div id="add-file-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Add File</h2>
                <button class="modal-close" onclick="app.closeModal('add-file-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label form-label-required">File Name</label>
                    <input type="text" class="form-input" id="add-file-name" placeholder="customer_data">
                    <div class="form-help">Logical name for this file</div>
                </div>
                <div class="form-group">
                    <label class="form-label form-label-required">File Path</label>
                    <input type="text" class="form-input" id="add-file-path" placeholder="data/customers.csv">
                    <div class="form-help">Path to the file to validate</div>
                </div>
                <div class="form-group">
                    <label class="form-label form-label-required">File Format</label>
                    <select class="form-select" id="add-file-format">
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                        <option value="json">JSON</option>
                        <option value="parquet">Parquet</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('add-file-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveNewFile()">Add File</button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>About DataK9 Studio</h2>
                <button class="modal-close" onclick="app.closeModal('about-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 64px; margin-bottom: 16px;">ðŸ•</div>
                    <h3 style="font-size: 24px; margin-bottom: 8px;">DataK9 Studio</h3>
                    <p style="color: var(--text-secondary); font-style: italic;">Your IDE for Data Quality</p>
                    <p style="color: var(--text-muted); font-size: 12px; margin-top: 8px;">Version 1.0.0</p>
                </div>
                <div class="help-section">
                    <h4>What is DataK9 Studio?</h4>
                    <p>DataK9 Studio is a professional IDE-style interface for creating and modifying YAML configuration files for data validation frameworks.</p>
                </div>
                <div class="help-section">
                    <h4>Features</h4>
                    <ul>
                        <li>22 production-tested validation types</li>
                        <li>Visual configuration builder</li>
                        <li>Live YAML editor with syntax highlighting</li>
                        <li>Two-way sync between UI and YAML</li>
                        <li>Comprehensive validation catalog</li>
                        <li>Context-sensitive help</li>
                        <li>Auto-save to localStorage</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h4>Author</h4>
                    <p>Created by Daniel Edge</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="app.closeModal('about-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- ============================================================================
         Monaco Editor (Self-Hosted for Corporate Environments)
         ============================================================================ -->
    <script src="monaco-editor/min/vs/loader.js"></script>

    <!-- ============================================================================
         Application JavaScript
         ============================================================================ -->
    <script>
        /* ========================================================================
           DataK9 Studio Application
           ========================================================================

           This application manages the entire IDE experience including:
           - Project state management
           - Visual configuration builder
           - YAML editor integration
           - Two-way sync between UI and YAML
           - Validation catalog
           - Import/Export functionality
           - localStorage persistence
        */

        // Application state object
        const app = {
            // Current project configuration
            config: {
                validation_job: {
                    name: '',
                    description: ''
                },
                settings: {
                    chunk_size: 50000,
                    max_sample_failures: 100,
                    fail_on_error: true,
                    fail_on_warning: false,
                    log_level: 'INFO'
                },
                files: []
            },

            // Currently selected file and validation
            selectedFile: null,
            selectedValidation: null,

            // Monaco editor instance
            monacoEditor: null,

            // Wizard state
            wizardStep: 1,

            // Flag to prevent circular updates during sync
            isSyncing: false,

            /* ====================================================================
               Validation Library - 22 Actual Validation Types
               ====================================================================

               This library contains all validation types supported by the
               DataK9 validation framework, organized by category.
               Each validation includes:
               - icon: Visual identifier
               - name: Display name
               - type: YAML type identifier
               - category: Organizational category
               - description: What the validation does
               - params: Array of parameter definitions
               - examples: Common use cases
               - tips: Best practices
            */
            validationLibrary: {
                // File-Level Validations
                'EmptyFileCheck': {
                    icon: 'ðŸ“„',
                    name: 'Empty File Check',
                    type: 'EmptyFileCheck',
                    category: 'File-Level',
                    description: 'Validates that the file is not empty and optionally contains data rows',
                    params: [
                        {
                            name: 'check_data_rows',
                            label: 'Check Data Rows',
                            type: 'checkbox',
                            required: false,
                            help: 'If true, checks for actual data rows (not just headers)'
                        }
                    ],
                    examples: 'Ensure input files are not empty before processing',
                    tips: 'Use ERROR severity to prevent processing empty files'
                },

                'RowCountRangeCheck': {
                    icon: 'ðŸ“Š',
                    name: 'Row Count Range Check',
                    type: 'RowCountRangeCheck',
                    category: 'File-Level',
                    description: 'Validates that the number of rows falls within specified bounds',
                    params: [
                        {
                            name: 'min_rows',
                            label: 'Minimum Rows',
                            type: 'number',
                            required: false,
                            help: 'Minimum acceptable number of rows'
                        },
                        {
                            name: 'max_rows',
                            label: 'Maximum Rows',
                            type: 'number',
                            required: false,
                            help: 'Maximum acceptable number of rows'
                        }
                    ],
                    examples: 'Validate daily extract contains expected volume (e.g., min_rows: 1000)',
                    tips: 'Set realistic bounds based on historical data patterns'
                },

                'FileSizeCheck': {
                    icon: 'ðŸ’¾',
                    name: 'File Size Check',
                    type: 'FileSizeCheck',
                    category: 'File-Level',
                    description: 'Validates file size is within acceptable limits',
                    params: [
                        {
                            name: 'min_size_mb',
                            label: 'Min Size (MB)',
                            type: 'number',
                            required: false,
                            help: 'Minimum file size in megabytes'
                        },
                        {
                            name: 'max_size_mb',
                            label: 'Max Size (MB)',
                            type: 'number',
                            required: false,
                            help: 'Maximum file size in megabytes'
                        },
                        {
                            name: 'max_size_gb',
                            label: 'Max Size (GB)',
                            type: 'number',
                            required: false,
                            help: 'Maximum file size in gigabytes'
                        }
                    ],
                    examples: 'Prevent processing of unexpectedly large files',
                    tips: 'Use to catch corrupt or malformed files early'
                },

                // Schema Validations
                'SchemaMatchCheck': {
                    icon: 'ðŸŽ¨',
                    name: 'Schema Match Check',
                    type: 'SchemaMatchCheck',
                    category: 'Schema',
                    description: 'Validates columns and their data types match expected schema',
                    params: [
                        {
                            name: 'expected_columns',
                            label: 'Expected Columns (comma-separated)',
                            type: 'text',
                            required: true,
                            help: 'List of expected column names'
                        },
                        {
                            name: 'allow_extra',
                            label: 'Allow Extra Columns',
                            type: 'checkbox',
                            required: false,
                            help: 'Permit additional columns not in expected list'
                        },
                        {
                            name: 'allow_missing',
                            label: 'Allow Missing Columns',
                            type: 'checkbox',
                            required: false,
                            help: 'Permit missing columns from expected list'
                        }
                    ],
                    examples: 'Enforce strict schema: expected_columns: [id, name, email]',
                    tips: 'Use strict matching (both false) for critical interfaces'
                },

                'ColumnPresenceCheck': {
                    icon: 'ðŸ“‹',
                    name: 'Column Presence Check',
                    type: 'ColumnPresenceCheck',
                    category: 'Schema',
                    description: 'Checks that required columns exist in the file',
                    params: [
                        {
                            name: 'required_columns',
                            label: 'Required Columns (comma-separated)',
                            type: 'text',
                            required: true,
                            help: 'Columns that must be present'
                        },
                        {
                            name: 'case_sensitive',
                            label: 'Case Sensitive',
                            type: 'checkbox',
                            required: false,
                            help: 'Whether column name matching is case-sensitive'
                        }
                    ],
                    examples: 'Ensure critical columns exist: required_columns: [customer_id, order_date]',
                    tips: 'Lighter weight than SchemaMatchCheck when you only care about presence'
                },

                // Field-Level Validations
                'MandatoryFieldCheck': {
                    icon: 'ðŸ“',
                    name: 'Mandatory Field Check',
                    type: 'MandatoryFieldCheck',
                    category: 'Field-Level',
                    description: 'Validates that specified fields are not null or empty',
                    params: [
                        {
                            name: 'fields',
                            label: 'Fields (comma-separated)',
                            type: 'text',
                            required: true,
                            help: 'Fields that cannot be null or empty'
                        }
                    ],
                    examples: 'Ensure primary keys are populated: fields: [customer_id, order_id]',
                    tips: 'Use for critical fields that must always have values'
                },

                'RegexCheck': {
                    icon: 'ðŸ”¤',
                    name: 'Regex Pattern Check',
                    type: 'RegexCheck',
                    category: 'Field-Level',
                    description: 'Validates field values match a regular expression pattern',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Field to validate'
                        },
                        {
                            name: 'pattern',
                            label: 'Regex Pattern',
                            type: 'text',
                            required: true,
                            help: 'Regular expression pattern to match'
                        },
                        {
                            name: 'message',
                            label: 'Error Message',
                            type: 'text',
                            required: false,
                            help: 'Custom error message for failures'
                        },
                        {
                            name: 'invert',
                            label: 'Invert Match',
                            type: 'checkbox',
                            required: false,
                            help: 'Fail if pattern DOES match (instead of does not match)'
                        }
                    ],
                    examples: 'Email: ^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$',
                    tips: 'Test patterns thoroughly - use online regex testers'
                },

                'ValidValuesCheck': {
                    icon: 'ðŸŽ¯',
                    name: 'Valid Values Check',
                    type: 'ValidValuesCheck',
                    category: 'Field-Level',
                    description: 'Validates field values are in an allowed list',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Field to validate'
                        },
                        {
                            name: 'valid_values',
                            label: 'Valid Values (comma-separated)',
                            type: 'text',
                            required: true,
                            help: 'List of acceptable values'
                        }
                    ],
                    examples: 'Status field: valid_values: [active, inactive, pending]',
                    tips: 'Great for categorical fields with fixed options'
                },

                'RangeCheck': {
                    icon: 'ðŸ“',
                    name: 'Range Check',
                    type: 'RangeCheck',
                    category: 'Field-Level',
                    description: 'Validates numeric values fall within a specified range',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Numeric field to validate'
                        },
                        {
                            name: 'min_value',
                            label: 'Minimum Value',
                            type: 'number',
                            required: false,
                            help: 'Minimum acceptable value (inclusive)'
                        },
                        {
                            name: 'max_value',
                            label: 'Maximum Value',
                            type: 'number',
                            required: false,
                            help: 'Maximum acceptable value (inclusive)'
                        }
                    ],
                    examples: 'Age: min_value: 0, max_value: 120',
                    tips: 'Set realistic bounds based on business rules'
                },

                'DateFormatCheck': {
                    icon: 'ðŸ“…',
                    name: 'Date Format Check',
                    type: 'DateFormatCheck',
                    category: 'Field-Level',
                    description: 'Validates date fields match expected format',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Date field to validate'
                        },
                        {
                            name: 'format',
                            label: 'Date Format',
                            type: 'text',
                            required: true,
                            help: 'Expected date format (e.g., %Y-%m-%d for 2024-01-15)'
                        }
                    ],
                    examples: 'ISO date: format: %Y-%m-%d, US date: format: %m/%d/%Y',
                    tips: 'Common formats: %Y-%m-%d (2024-01-15), %d/%m/%Y (15/01/2024)'
                },

                // Record-Level Validations
                'DuplicateRowCheck': {
                    icon: 'ðŸ”„',
                    name: 'Duplicate Row Check',
                    type: 'DuplicateRowCheck',
                    category: 'Record-Level',
                    description: 'Detects duplicate rows based on key fields or all fields',
                    params: [
                        {
                            name: 'key_fields',
                            label: 'Key Fields (comma-separated)',
                            type: 'text',
                            required: false,
                            help: 'Fields to use for duplicate detection (leave empty for all fields)'
                        },
                        {
                            name: 'consider_all_fields',
                            label: 'Consider All Fields',
                            type: 'checkbox',
                            required: false,
                            help: 'Check for duplicates across all columns'
                        }
                    ],
                    examples: 'Find duplicate orders: key_fields: [order_id]',
                    tips: 'Use key_fields for logical duplicates, all fields for exact duplicates'
                },

                'BlankRecordCheck': {
                    icon: 'â¬œ',
                    name: 'Blank Record Check',
                    type: 'BlankRecordCheck',
                    category: 'Record-Level',
                    description: 'Detects rows where all fields are empty or null',
                    params: [
                        {
                            name: 'exclude_fields',
                            label: 'Exclude Fields (comma-separated)',
                            type: 'text',
                            required: false,
                            help: 'Fields to ignore when checking for blank rows'
                        }
                    ],
                    examples: 'Find completely empty rows (common in Excel extracts)',
                    tips: 'Useful for cleaning up extracts with trailing empty rows'
                },

                'UniqueKeyCheck': {
                    icon: 'ðŸ”‘',
                    name: 'Unique Key Check',
                    type: 'UniqueKeyCheck',
                    category: 'Record-Level',
                    description: 'Validates that key field combinations are unique',
                    params: [
                        {
                            name: 'key_fields',
                            label: 'Key Fields (comma-separated)',
                            type: 'text',
                            required: true,
                            help: 'Fields that should form a unique key'
                        }
                    ],
                    examples: 'Composite key: key_fields: [customer_id, order_date]',
                    tips: 'Critical for data integrity - use ERROR severity'
                },

                // Advanced Validations
                'StatisticalOutlierCheck': {
                    icon: 'ðŸ“Š',
                    name: 'Statistical Outlier Check',
                    type: 'StatisticalOutlierCheck',
                    category: 'Advanced',
                    description: 'Detects statistical outliers using z-score or IQR methods',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Numeric field to analyze for outliers'
                        },
                        {
                            name: 'method',
                            label: 'Detection Method',
                            type: 'select',
                            options: ['zscore', 'iqr'],
                            required: false,
                            help: 'Method: zscore (standard deviations) or iqr (interquartile range)'
                        },
                        {
                            name: 'threshold',
                            label: 'Threshold',
                            type: 'number',
                            required: false,
                            help: 'Threshold value (e.g., 3 for z-score, 1.5 for IQR)'
                        }
                    ],
                    examples: 'Detect unusual prices: field: price, method: zscore, threshold: 3',
                    tips: 'Use WARNING severity - outliers are not always errors'
                },

                'CrossFieldComparisonCheck': {
                    icon: 'âš–ï¸',
                    name: 'Cross-Field Comparison',
                    type: 'CrossFieldComparisonCheck',
                    category: 'Advanced',
                    description: 'Compares two fields using logical operators',
                    params: [
                        {
                            name: 'field_a',
                            label: 'Field A',
                            type: 'text',
                            required: true,
                            help: 'First field to compare'
                        },
                        {
                            name: 'operator',
                            label: 'Operator',
                            type: 'select',
                            options: ['>', '<', '>=', '<=', '==', '!='],
                            required: true,
                            help: 'Comparison operator'
                        },
                        {
                            name: 'field_b',
                            label: 'Field B',
                            type: 'text',
                            required: true,
                            help: 'Second field to compare'
                        }
                    ],
                    examples: 'End date after start: field_a: end_date, operator: >=, field_b: start_date',
                    tips: 'Essential for temporal and logical consistency checks'
                },

                'FreshnessCheck': {
                    icon: 'â°',
                    name: 'Freshness Check',
                    type: 'FreshnessCheck',
                    category: 'Advanced',
                    description: 'Validates data or file freshness (not too old)',
                    params: [
                        {
                            name: 'check_type',
                            label: 'Check Type',
                            type: 'select',
                            options: ['file', 'data'],
                            required: false,
                            help: 'Check file timestamp or data field'
                        },
                        {
                            name: 'max_age_hours',
                            label: 'Max Age (hours)',
                            type: 'number',
                            required: true,
                            help: 'Maximum acceptable age in hours'
                        },
                        {
                            name: 'date_field',
                            label: 'Date Field (for data check)',
                            type: 'text',
                            required: false,
                            help: 'Field containing timestamp (required if check_type is data)'
                        }
                    ],
                    examples: 'Daily file: check_type: file, max_age_hours: 24',
                    tips: 'Critical for time-sensitive data pipelines'
                },

                'CompletenessCheck': {
                    icon: 'âœ”ï¸',
                    name: 'Completeness Check',
                    type: 'CompletenessCheck',
                    category: 'Advanced',
                    description: 'Validates minimum percentage of non-null values in a field',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Field to check completeness'
                        },
                        {
                            name: 'min_completeness',
                            label: 'Min Completeness (0.0-1.0)',
                            type: 'number',
                            required: true,
                            help: 'Minimum acceptable completeness (e.g., 0.95 for 95%)'
                        }
                    ],
                    examples: 'Optional field 80% complete: field: phone, min_completeness: 0.8',
                    tips: 'Use for fields that should be mostly populated'
                },

                'StringLengthCheck': {
                    icon: 'ðŸ“',
                    name: 'String Length Check',
                    type: 'StringLengthCheck',
                    category: 'Advanced',
                    description: 'Validates string field length is within bounds',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'String field to validate'
                        },
                        {
                            name: 'min_length',
                            label: 'Min Length',
                            type: 'number',
                            required: false,
                            help: 'Minimum string length'
                        },
                        {
                            name: 'max_length',
                            label: 'Max Length',
                            type: 'number',
                            required: false,
                            help: 'Maximum string length'
                        }
                    ],
                    examples: 'Product code: min_length: 3, max_length: 10',
                    tips: 'Useful for catching truncation or malformed data'
                },

                'NumericPrecisionCheck': {
                    icon: 'ðŸ”¢',
                    name: 'Numeric Precision Check',
                    type: 'NumericPrecisionCheck',
                    category: 'Advanced',
                    description: 'Validates decimal places in numeric fields',
                    params: [
                        {
                            name: 'field',
                            label: 'Field Name',
                            type: 'text',
                            required: true,
                            help: 'Numeric field to validate'
                        },
                        {
                            name: 'max_decimal_places',
                            label: 'Max Decimal Places',
                            type: 'number',
                            required: false,
                            help: 'Maximum allowed decimal places'
                        },
                        {
                            name: 'exact_decimal_places',
                            label: 'Exact Decimal Places',
                            type: 'number',
                            required: false,
                            help: 'Exact number of decimal places required'
                        }
                    ],
                    examples: 'Currency: exact_decimal_places: 2',
                    tips: 'Important for financial data consistency'
                },

                // Cross-File Validations
                'ReferentialIntegrityCheck': {
                    icon: 'ðŸ”—',
                    name: 'Referential Integrity Check',
                    type: 'ReferentialIntegrityCheck',
                    category: 'Cross-File',
                    description: 'Validates foreign key relationships between files',
                    params: [
                        {
                            name: 'foreign_key',
                            label: 'Foreign Key Column',
                            type: 'text',
                            required: true,
                            help: 'Column in this file containing foreign key'
                        },
                        {
                            name: 'reference_file',
                            label: 'Reference File Path',
                            type: 'text',
                            required: true,
                            help: 'Path to file containing referenced data'
                        },
                        {
                            name: 'reference_key',
                            label: 'Reference Key Column',
                            type: 'text',
                            required: true,
                            help: 'Column in reference file containing primary key'
                        },
                        {
                            name: 'allow_null',
                            label: 'Allow Null',
                            type: 'checkbox',
                            required: false,
                            help: 'Allow null foreign key values'
                        },
                        {
                            name: 'reference_file_format',
                            label: 'Reference Format',
                            type: 'select',
                            options: ['csv', 'parquet', 'excel', 'json'],
                            required: false,
                            help: 'Format of reference file'
                        }
                    ],
                    examples: 'Orders reference customers: foreign_key: customer_id, reference_file: customers.csv, reference_key: id',
                    tips: 'Critical for maintaining data integrity across related files'
                },

                'CrossFileComparisonCheck': {
                    icon: 'ðŸ“Š',
                    name: 'Cross-File Comparison',
                    type: 'CrossFileComparisonCheck',
                    category: 'Cross-File',
                    description: 'Compares aggregated values between two files',
                    params: [
                        {
                            name: 'aggregation',
                            label: 'Aggregation Type',
                            type: 'select',
                            options: ['sum', 'count', 'mean', 'min', 'max'],
                            required: true,
                            help: 'Aggregation to perform on this file'
                        },
                        {
                            name: 'column',
                            label: 'Column Name',
                            type: 'text',
                            required: false,
                            help: 'Column to aggregate (not needed for count)'
                        },
                        {
                            name: 'comparison',
                            label: 'Comparison Operator',
                            type: 'select',
                            options: ['==', '!=', '>', '<', '>=', '<='],
                            required: true,
                            help: 'How to compare the aggregates'
                        },
                        {
                            name: 'reference_file',
                            label: 'Reference File',
                            type: 'text',
                            required: true,
                            help: 'File to compare against'
                        },
                        {
                            name: 'reference_aggregation',
                            label: 'Reference Aggregation',
                            type: 'select',
                            options: ['sum', 'count', 'mean', 'min', 'max'],
                            required: true,
                            help: 'Aggregation to perform on reference file'
                        },
                        {
                            name: 'reference_column',
                            label: 'Reference Column',
                            type: 'text',
                            required: false,
                            help: 'Column in reference file to aggregate'
                        },
                        {
                            name: 'tolerance',
                            label: 'Tolerance (absolute)',
                            type: 'number',
                            required: false,
                            help: 'Acceptable absolute difference'
                        },
                        {
                            name: 'tolerance_pct',
                            label: 'Tolerance (%)',
                            type: 'number',
                            required: false,
                            help: 'Acceptable percentage difference'
                        }
                    ],
                    examples: 'Order totals match: aggregation: sum, column: total, comparison: ==, reference_file: summary.csv',
                    tips: 'Use tolerance for floating-point comparisons'
                },

                'CrossFileDuplicateCheck': {
                    icon: 'ðŸ”',
                    name: 'Cross-File Duplicate Check',
                    type: 'CrossFileDuplicateCheck',
                    category: 'Cross-File',
                    description: 'Finds duplicate records across multiple files',
                    params: [
                        {
                            name: 'columns',
                            label: 'Columns to Check (comma-separated)',
                            type: 'text',
                            required: true,
                            help: 'Columns to use for duplicate detection'
                        },
                        {
                            name: 'reference_files',
                            label: 'Reference Files (comma-separated)',
                            type: 'textarea',
                            required: true,
                            help: 'Paths to files to check for duplicates'
                        },
                        {
                            name: 'reference_file_format',
                            label: 'Reference Format',
                            type: 'select',
                            options: ['csv', 'parquet', 'excel', 'json'],
                            required: false,
                            help: 'Format of reference files'
                        }
                    ],
                    examples: 'No duplicate IDs across files: columns: [customer_id], reference_files: [archive1.csv, archive2.csv]',
                    tips: 'Useful for preventing duplicates in incremental loads'
                }
            },

            /* ====================================================================
               Application Initialization
               ==================================================================== */

            init() {
                console.log('Initializing DataK9 Studio...');

                // Load saved project from localStorage if exists
                this.loadFromLocalStorage();

                // Initialize Monaco Editor
                this.initMonacoEditor();

                // Set up keyboard shortcuts
                this.initKeyboardShortcuts();

                // Render initial UI state
                this.render();

                console.log('DataK9 Studio initialized successfully');
            },

            /* ====================================================================
               Monaco Editor Initialization
               ==================================================================== */

            initMonacoEditor() {
                require.config({
                    paths: {
                        'vs': 'monaco-editor/min/vs'
                    }
                });

                require(['vs/editor/editor.main'], () => {
                    this.monacoEditor = monaco.editor.create(
                        document.getElementById('monaco-editor'),
                        {
                            value: this.generateYAML(),
                            language: 'yaml',
                            theme: 'vs-dark',
                            automaticLayout: true,
                            minimap: { enabled: true },
                            fontSize: 13,
                            lineNumbers: 'on',
                            roundedSelection: false,
                            scrollBeyondLastLine: false,
                            readOnly: false,
                            cursorStyle: 'line',
                            wordWrap: 'on'
                        }
                    );

                    // Listen for changes in Monaco Editor
                    this.monacoEditor.onDidChangeModelContent(() => {
                        if (!this.isSyncing) {
                            this.syncFromYAML();
                        }
                    });

                    console.log('Monaco Editor initialized');
                });
            },

            /* ====================================================================
               Keyboard Shortcuts
               ==================================================================== */

            initKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + S: Save (export)
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        this.exportYAML();
                    }
                    // Ctrl/Cmd + N: New project
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        this.startNewProject();
                    }
                    // Ctrl/Cmd + O: Import
                    if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                        e.preventDefault();
                        this.openImportDialog();
                    }
                    // Ctrl/Cmd + E: Export
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        this.exportYAML();
                    }

                    // Validation management shortcuts (only when a validation is selected)
                    if (this.selectedFile !== null && this.selectedValidation !== null) {
                        // Ctrl/Cmd + D: Duplicate selected validation
                        if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                            e.preventDefault();
                            this.duplicateValidation(this.selectedFile, this.selectedValidation);
                        }
                        // Ctrl/Cmd + Up Arrow: Move validation up
                        if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowUp') {
                            e.preventDefault();
                            this.moveValidationUp(this.selectedFile, this.selectedValidation);
                        }
                        // Ctrl/Cmd + Down Arrow: Move validation down
                        if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowDown') {
                            e.preventDefault();
                            this.moveValidationDown(this.selectedFile, this.selectedValidation);
                        }
                        // Delete key: Delete selected validation
                        if (e.key === 'Delete') {
                            e.preventDefault();
                            if (confirm('Delete this validation?')) {
                                const file = this.config.files[this.selectedFile];
                                file.validations.splice(this.selectedValidation, 1);
                                this.selectedValidation = null;
                                this.updateYAMLEditor();
                                this.saveToLocalStorage();
                                this.render();
                            }
                        }
                    }
                });
            },

            /* ====================================================================
               Rendering Functions
               ==================================================================== */

            render() {
                this.renderFileTree();
                this.renderVisualEditor();
                this.updateYAMLEditor();
                this.updateValidationSummary();
                this.updateHelpPanel();

                // Show/hide welcome screen vs editor
                const hasProject = this.config.validation_job.name !== '';
                document.getElementById('welcome-screen').classList.toggle('hidden', hasProject);
                document.getElementById('editor-view').classList.toggle('hidden', !hasProject);
            },

            renderFileTree() {
                const container = document.getElementById('file-tree');

                if (this.config.files.length === 0) {
                    container.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted); font-size: 12px;">No files added yet</div>';
                    return;
                }

                let html = '';
                this.config.files.forEach((file, fileIndex) => {
                    const isSelected = this.selectedFile === fileIndex;
                    const isExpanded = true; // Always expanded for simplicity

                    html += `
                        <div class="file-item ${isExpanded ? 'expanded' : ''}"
                             draggable="true"
                             data-file-index="${fileIndex}"
                             ondragstart="app.handleFileDragStart(event, ${fileIndex})"
                             ondragend="app.handleFileDragEnd(event)"
                             ondragover="app.handleFileDragOver(event)"
                             ondrop="app.handleFileDrop(event, ${fileIndex})">
                            <div class="file-header ${isSelected ? 'selected' : ''}" onclick="app.selectFile(${fileIndex})">
                                <div class="file-info">
                                    <span class="file-drag-handle" title="Drag to reorder" onclick="event.stopPropagation()">â‹®â‹®</span>
                                    <span class="file-icon">ðŸ“„</span>
                                    <span class="file-name">${file.name}</span>
                                    <span class="file-format-badge">${file.format.toUpperCase()}</span>
                                </div>
                                <div class="file-actions">
                                    <button class="file-action-btn" onclick="event.stopPropagation(); app.addValidationToFile(${fileIndex})" title="Add Validation">
                                        +
                                    </button>
                                    <button class="file-action-btn" onclick="event.stopPropagation(); app.deleteFile(${fileIndex})" title="Delete File">
                                        ðŸ—‘ï¸
                                    </button>
                                </div>
                            </div>
                            <div class="validations-list">
                    `;

                    if (file.validations && file.validations.length > 0) {
                        file.validations.forEach((validation, valIndex) => {
                            const isValSelected = this.selectedFile === fileIndex && this.selectedValidation === valIndex;
                            const severity = validation.severity || 'ERROR';
                            const valDef = this.validationLibrary[validation.type];
                            const icon = valDef ? valDef.icon : 'âœ“';
                            const name = valDef ? valDef.name : validation.type;

                            html += `
                                <div class="validation-item ${isValSelected ? 'selected' : ''} ${severity.toLowerCase()}-severity"
                                     draggable="true"
                                     data-file-index="${fileIndex}"
                                     data-validation-index="${valIndex}"
                                     onclick="app.selectValidation(${fileIndex}, ${valIndex})"
                                     oncontextmenu="app.showValidationContextMenu(event, ${fileIndex}, ${valIndex}); return false;"
                                     ondragstart="app.handleValidationDragStart(event, ${fileIndex}, ${valIndex})"
                                     ondragend="app.handleValidationDragEnd(event)"
                                     ondragover="app.handleValidationDragOver(event)"
                                     ondrop="app.handleValidationDrop(event, ${fileIndex}, ${valIndex})"
                                     ontouchstart="app.handleValidationTouchStart(event, ${fileIndex}, ${valIndex})"
                                     ontouchmove="app.handleValidationTouchMove(event)"
                                     ontouchend="app.handleValidationTouchEnd(event)">
                                    <span class="validation-drag-handle" title="Drag to reorder" onclick="event.stopPropagation()">â˜°</span>
                                    <div class="validation-info">
                                        <span class="validation-icon">${icon}</span>
                                        <span class="validation-name">${name}</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 4px;">
                                        <span class="severity-badge ${severity.toLowerCase()}">${severity}</span>
                                        <div class="validation-actions">
                                            <button class="validation-action-btn duplicate-btn"
                                                    onclick="event.stopPropagation(); app.duplicateValidation(${fileIndex}, ${valIndex})"
                                                    title="Duplicate validation">
                                                ðŸ“‹
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html += '<div style="padding: 8px; font-size: 11px; color: var(--text-muted); text-align: center;">No validations yet</div>';
                    }

                    html += `
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            },

            renderVisualEditor() {
                const container = document.getElementById('visual-editor');

                if (this.selectedFile === null) {
                    container.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-muted);">
                            <div style="text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 16px;">ðŸ“„</div>
                                <div style="font-size: 16px; margin-bottom: 8px;">No file selected</div>
                                <div style="font-size: 13px;">Select a file from the sidebar or add a new one</div>
                            </div>
                        </div>
                    `;
                    return;
                }

                const file = this.config.files[this.selectedFile];

                let html = `
                    <div class="card">
                        <div class="card-header">
                            <h3>ðŸ“„ File: ${file.name}</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">File Name</label>
                                <input type="text" class="form-input" value="${file.name}"
                                       onchange="app.updateFileName(${this.selectedFile}, this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">File Path</label>
                                <input type="text" class="form-input" value="${file.path}"
                                       onchange="app.updateFilePath(${this.selectedFile}, this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Format</label>
                                <select class="form-select" onchange="app.updateFileFormat(${this.selectedFile}, this.value)">
                                    <option value="csv" ${file.format === 'csv' ? 'selected' : ''}>CSV</option>
                                    <option value="excel" ${file.format === 'excel' ? 'selected' : ''}>Excel</option>
                                    <option value="json" ${file.format === 'json' ? 'selected' : ''}>JSON</option>
                                    <option value="parquet" ${file.format === 'parquet' ? 'selected' : ''}>Parquet</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>âœ“ Validations (${file.validations ? file.validations.length : 0})</h3>
                            <button class="btn btn-primary btn-small" onclick="app.addValidationToFile(${this.selectedFile})">
                                + Add Validation
                            </button>
                        </div>
                        <div class="card-body">
                `;

                if (!file.validations || file.validations.length === 0) {
                    html += '<div style="text-align: center; padding: 32px; color: var(--text-muted);">No validations configured yet</div>';
                } else {
                    html += '<div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 8px;">Click a validation in the sidebar to edit it</div>';
                }

                html += `
                        </div>
                    </div>
                `;

                if (this.selectedValidation !== null) {
                    const validation = file.validations[this.selectedValidation];
                    const valDef = this.validationLibrary[validation.type];

                    if (valDef) {
                        html += `
                            <div class="card" style="border: 2px solid var(--k9-blue);">
                                <div class="card-header">
                                    <h3>${valDef.icon} ${valDef.name}</h3>
                                </div>
                                <div class="card-body">
                                    <p style="color: var(--text-secondary); margin-bottom: 16px;">${valDef.description}</p>

                                    <div class="form-group">
                                        <label class="form-label">Severity</label>
                                        <select class="form-select" id="edit-severity">
                                            <option value="ERROR" ${validation.severity === 'ERROR' ? 'selected' : ''}>ERROR</option>
                                            <option value="WARNING" ${validation.severity === 'WARNING' ? 'selected' : ''}>WARNING</option>
                                        </select>
                                        <div class="form-help">Use ERROR for critical requirements, WARNING for quality issues</div>
                                    </div>
                        `;

                        // Render parameter fields
                        valDef.params.forEach(param => {
                            const currentValue = validation.params && validation.params[param.name] !== undefined
                                ? validation.params[param.name]
                                : '';

                            html += `<div class="form-group">`;
                            html += `<label class="form-label ${param.required ? 'form-label-required' : ''}">${param.label}</label>`;

                            if (param.type === 'select') {
                                html += `<select class="form-select" id="edit-param-${param.name}">`;
                                html += `<option value="">-- Select --</option>`;
                                param.options.forEach(opt => {
                                    html += `<option value="${opt}" ${currentValue === opt ? 'selected' : ''}>${opt}</option>`;
                                });
                                html += `</select>`;
                            } else if (param.type === 'checkbox') {
                                html += `
                                    <div class="form-checkbox-group">
                                        <input type="checkbox" class="form-checkbox" id="edit-param-${param.name}"
                                               ${currentValue ? 'checked' : ''}>
                                        <label class="form-label mb-0">${param.help || 'Enable'}</label>
                                    </div>
                                `;
                            } else if (param.type === 'textarea') {
                                html += `<textarea class="form-textarea" id="edit-param-${param.name}">${currentValue}</textarea>`;
                            } else if (param.type === 'number') {
                                html += `<input type="number" step="any" class="form-input" id="edit-param-${param.name}" value="${currentValue}">`;
                            } else {
                                html += `<input type="text" class="form-input" id="edit-param-${param.name}" value="${currentValue}">`;
                            }

                            if (param.help && param.type !== 'checkbox') {
                                html += `<div class="form-help">${param.help}</div>`;
                            }
                            html += `</div>`;
                        });

                        html += `
                                    <div class="form-group">
                                        <label class="form-label">Condition (Optional)</label>
                                        <input type="text" class="form-input" id="edit-condition"
                                               value="${validation.condition || ''}"
                                               placeholder="e.g., row['status'] == 'active'">
                                        <div class="form-help">Python expression for conditional execution</div>
                                    </div>

                                    <div style="display: flex; gap: 8px; margin-top: 24px;">
                                        <button class="btn btn-primary" onclick="app.saveCurrentValidation()">
                                            ðŸ’¾ Save Changes
                                        </button>
                                        <button class="btn btn-danger" onclick="app.deleteCurrentValidation()">
                                            ðŸ—‘ï¸ Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }

                container.innerHTML = html;
            },

            updateYAMLEditor() {
                if (this.isSyncing) return;

                this.isSyncing = true;
                const yaml = this.generateYAML();

                if (this.monacoEditor) {
                    this.monacoEditor.setValue(yaml);
                } else {
                    document.getElementById('yaml-textarea').value = yaml;
                }

                this.isSyncing = false;
            },

            updateValidationSummary() {
                const summary = document.getElementById('validation-summary');

                if (this.config.validation_job.name === '') {
                    summary.textContent = 'No project loaded';
                    return;
                }

                const fileCount = this.config.files.length;
                let validationCount = 0;
                this.config.files.forEach(file => {
                    validationCount += file.validations ? file.validations.length : 0;
                });

                summary.textContent = `Project: ${this.config.validation_job.name} | ${fileCount} file(s) | ${validationCount} validation(s)`;
            },

            updateHelpPanel() {
                const container = document.getElementById('help-content');

                if (this.selectedFile !== null && this.selectedValidation !== null) {
                    const file = this.config.files[this.selectedFile];
                    const validation = file.validations[this.selectedValidation];
                    const valDef = this.validationLibrary[validation.type];

                    if (valDef) {
                        container.innerHTML = `
                            <div class="help-section">
                                <h4>${valDef.icon} ${valDef.name}</h4>
                                <p>${valDef.description}</p>
                            </div>
                            <div class="help-section">
                                <h4>Category</h4>
                                <p>${valDef.category}</p>
                            </div>
                            <div class="help-section">
                                <h4>Common Use Cases</h4>
                                <p>${valDef.examples}</p>
                            </div>
                            <div class="help-section">
                                <h4>Tips</h4>
                                <p>${valDef.tips}</p>
                            </div>
                            <div class="help-section">
                                <h4>YAML Example</h4>
                                <div class="help-code">type: ${valDef.type}
severity: ERROR
params:
  # Configure parameters</div>
                            </div>
                        `;
                        return;
                    }
                }

                // Default help content
                container.innerHTML = `
                    <div class="help-section">
                        <h4>Welcome to DataK9 Studio</h4>
                        <p>Your professional IDE for building data validation configurations.</p>
                    </div>
                    <div class="help-section">
                        <h4>Quick Tips</h4>
                        <ul>
                            <li>Use ERROR severity for critical data requirements</li>
                            <li>Use WARNING severity for data quality issues</li>
                            <li>All validations support conditional execution</li>
                            <li>Changes are auto-saved to localStorage</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4>Keyboard Shortcuts</h4>
                        <ul>
                            <li>Ctrl+S - Export configuration</li>
                            <li>Ctrl+N - New project</li>
                            <li>Ctrl+O - Import YAML</li>
                            <li>Ctrl+E - Export YAML</li>
                        </ul>
                    </div>
                `;
            },

            /* ====================================================================
               YAML Generation
               ==================================================================== */

            generateYAML() {
                // Generate YAML string from config object
                // Note: This is a simplified YAML generator
                // For production, consider using a proper YAML library

                let yaml = '';

                // Validation Job section
                yaml += 'validation_job:\n';
                yaml += `  name: "${this.config.validation_job.name}"\n`;
                if (this.config.validation_job.description) {
                    yaml += `  description: "${this.config.validation_job.description}"\n`;
                }
                yaml += '\n';

                // Settings section
                yaml += 'settings:\n';
                yaml += `  chunk_size: ${this.config.settings.chunk_size}\n`;
                yaml += `  max_sample_failures: ${this.config.settings.max_sample_failures}\n`;
                yaml += `  fail_on_error: ${this.config.settings.fail_on_error}\n`;
                yaml += `  fail_on_warning: ${this.config.settings.fail_on_warning}\n`;
                yaml += `  log_level: "${this.config.settings.log_level}"\n`;
                yaml += '\n';

                // Files section
                yaml += 'files:\n';
                if (this.config.files.length === 0) {
                    yaml += '  []\n';
                } else {
                    this.config.files.forEach(file => {
                        yaml += `  - name: "${file.name}"\n`;
                        yaml += `    path: "${file.path}"\n`;
                        yaml += `    format: "${file.format}"\n`;
                        yaml += `    validations:\n`;

                        if (!file.validations || file.validations.length === 0) {
                            yaml += '      []\n';
                        } else {
                            file.validations.forEach(validation => {
                                yaml += `      - type: "${validation.type}"\n`;
                                yaml += `        severity: "${validation.severity || 'ERROR'}"\n`;

                                if (validation.params && Object.keys(validation.params).length > 0) {
                                    yaml += `        params:\n`;
                                    for (const [key, value] of Object.entries(validation.params)) {
                                        if (value === undefined || value === null || value === '') continue;

                                        if (typeof value === 'boolean') {
                                            yaml += `          ${key}: ${value}\n`;
                                        } else if (typeof value === 'number') {
                                            yaml += `          ${key}: ${value}\n`;
                                        } else if (typeof value === 'string') {
                                            // Handle comma-separated values as arrays
                                            if (value.includes(',') && (key.includes('fields') || key.includes('columns') || key.includes('files'))) {
                                                const items = value.split(',').map(v => v.trim()).filter(v => v);
                                                yaml += `          ${key}:\n`;
                                                items.forEach(item => {
                                                    yaml += `            - "${item}"\n`;
                                                });
                                            } else {
                                                yaml += `          ${key}: "${value}"\n`;
                                            }
                                        }
                                    }
                                }

                                if (validation.condition) {
                                    yaml += `        condition: "${validation.condition}"\n`;
                                }
                            });
                        }
                    });
                }

                return yaml;
            },

            /* ====================================================================
               YAML Parsing (Import)
               ==================================================================== */

            syncFromYAML() {
                // This is a simplified YAML parser for demonstration
                // For production, use a proper YAML parsing library like js-yaml
                console.log('YAML sync not fully implemented - requires js-yaml library');
            },

            /* ====================================================================
               Project Management
               ==================================================================== */

            startNewProject() {
                this.openModal('new-project-modal');
                this.wizardStep = 1;
                this.updateWizardUI();
            },

            wizardNext() {
                if (this.wizardStep < 3) {
                    this.wizardStep++;
                    this.updateWizardUI();
                }
            },

            wizardBack() {
                if (this.wizardStep > 1) {
                    this.wizardStep--;
                    this.updateWizardUI();
                }
            },

            updateWizardUI() {
                // Update step indicators
                document.querySelectorAll('.wizard-step').forEach((step, index) => {
                    const stepNum = index + 1;
                    step.classList.remove('active', 'completed');
                    if (stepNum < this.wizardStep) {
                        step.classList.add('completed');
                    } else if (stepNum === this.wizardStep) {
                        step.classList.add('active');
                    }
                });

                // Show/hide step content
                for (let i = 1; i <= 3; i++) {
                    const content = document.getElementById(`wizard-step-${i}`);
                    content.classList.toggle('hidden', i !== this.wizardStep);
                }

                // Update buttons
                document.getElementById('wizard-back-btn').style.display = this.wizardStep > 1 ? 'inline-flex' : 'none';
                document.getElementById('wizard-next-btn').style.display = this.wizardStep < 3 ? 'inline-flex' : 'none';
                document.getElementById('wizard-finish-btn').style.display = this.wizardStep === 3 ? 'inline-flex' : 'none';
            },

            wizardFinish() {
                // Collect data from wizard
                this.config.validation_job.name = document.getElementById('wizard-project-name').value;
                this.config.validation_job.description = document.getElementById('wizard-project-description').value;

                this.config.settings.chunk_size = parseInt(document.getElementById('wizard-chunk-size').value) || 50000;
                this.config.settings.max_sample_failures = parseInt(document.getElementById('wizard-max-failures').value) || 100;
                this.config.settings.fail_on_error = document.getElementById('wizard-fail-error').checked;
                this.config.settings.fail_on_warning = document.getElementById('wizard-fail-warning').checked;
                this.config.settings.log_level = document.getElementById('wizard-log-level').value;

                const fileName = document.getElementById('wizard-file-name').value;
                const filePath = document.getElementById('wizard-file-path').value;
                const fileFormat = document.getElementById('wizard-file-format').value;

                if (fileName && filePath) {
                    this.config.files.push({
                        name: fileName,
                        path: filePath,
                        format: fileFormat,
                        validations: []
                    });
                }

                this.closeModal('new-project-modal');
                this.saveToLocalStorage();
                this.render();
            },

            /* ====================================================================
               File Management
               ==================================================================== */

            selectFile(index) {
                this.selectedFile = index;
                this.selectedValidation = null;
                this.render();
            },

            addFile() {
                this.openModal('add-file-modal');
                document.getElementById('add-file-name').value = '';
                document.getElementById('add-file-path').value = '';
                document.getElementById('add-file-format').value = 'csv';
            },

            saveNewFile() {
                const name = document.getElementById('add-file-name').value;
                const path = document.getElementById('add-file-path').value;
                const format = document.getElementById('add-file-format').value;

                if (!name || !path) {
                    alert('Please provide both file name and path');
                    return;
                }

                this.config.files.push({
                    name: name,
                    path: path,
                    format: format,
                    validations: []
                });

                this.closeModal('add-file-modal');
                this.saveToLocalStorage();
                this.render();
            },

            deleteFile(index) {
                if (confirm('Are you sure you want to delete this file?')) {
                    this.config.files.splice(index, 1);
                    if (this.selectedFile === index) {
                        this.selectedFile = null;
                        this.selectedValidation = null;
                    }
                    this.saveToLocalStorage();
                    this.render();
                }
            },

            updateFileName(index, value) {
                this.config.files[index].name = value;
                this.saveToLocalStorage();
                this.render();
            },

            updateFilePath(index, value) {
                this.config.files[index].path = value;
                this.saveToLocalStorage();
                this.render();
            },

            updateFileFormat(index, value) {
                this.config.files[index].format = value;
                this.saveToLocalStorage();
                this.render();
            },

            /* ====================================================================
               Validation Management
               ==================================================================== */

            selectValidation(fileIndex, valIndex) {
                this.selectedFile = fileIndex;
                this.selectedValidation = valIndex;
                this.render();
            },

            addValidationToFile(fileIndex) {
                this.selectedFile = fileIndex;
                this.openAddValidationDialog();
            },

            openAddValidationDialog() {
                this.openModal('add-validation-modal');
                this.renderValidationCatalog('add-validation');
            },

            renderValidationCatalog(prefix) {
                const categoriesEl = document.getElementById(`${prefix}-categories`);
                const listEl = document.getElementById(`${prefix}-list`);

                // Get unique categories
                const categories = [...new Set(Object.values(this.validationLibrary).map(v => v.category))];

                // Render category filters
                let catHTML = '<div class="category-filter active" onclick="app.filterCatalogCategory(\'' + prefix + '\', null)">All</div>';
                categories.forEach(cat => {
                    catHTML += `<div class="category-filter" onclick="app.filterCatalogCategory('${prefix}', '${cat}')">${cat}</div>`;
                });
                categoriesEl.innerHTML = catHTML;

                // Render validation items
                let itemsHTML = '';
                Object.entries(this.validationLibrary).forEach(([key, val]) => {
                    itemsHTML += `
                        <div class="validation-catalog-item" data-category="${val.category}" data-name="${val.name.toLowerCase()}"
                             onclick="app.selectValidationFromCatalog('${key}')">
                            <div class="validation-catalog-header">
                                <span class="validation-catalog-icon">${val.icon}</span>
                                <span class="validation-catalog-name">${val.name}</span>
                            </div>
                            <div class="validation-catalog-description">${val.description}</div>
                            <span class="validation-catalog-category">${val.category}</span>
                        </div>
                    `;
                });
                listEl.innerHTML = itemsHTML;
            },

            filterCatalogCategory(prefix, category) {
                // Update active state
                document.querySelectorAll(`#${prefix}-categories .category-filter`).forEach(el => {
                    el.classList.remove('active');
                });
                event.target.classList.add('active');

                // Filter items
                const items = document.querySelectorAll(`#${prefix}-list .validation-catalog-item`);
                items.forEach(item => {
                    if (!category || item.dataset.category === category) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            },

            filterCatalog() {
                const search = document.getElementById('catalog-search').value.toLowerCase();
                const items = document.querySelectorAll('#catalog-list .validation-catalog-item');
                items.forEach(item => {
                    if (item.dataset.name.includes(search)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            },

            filterAddValidation() {
                const search = document.getElementById('add-validation-search').value.toLowerCase();
                const items = document.querySelectorAll('#add-validation-list .validation-catalog-item');
                items.forEach(item => {
                    if (item.dataset.name.includes(search)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            },

            selectValidationFromCatalog(validationType) {
                if (this.selectedFile === null) {
                    alert('Please select a file first');
                    return;
                }

                const file = this.config.files[this.selectedFile];
                if (!file.validations) {
                    file.validations = [];
                }

                file.validations.push({
                    type: validationType,
                    severity: 'ERROR',
                    params: {}
                });

                this.selectedValidation = file.validations.length - 1;
                this.closeModal('add-validation-modal');
                this.saveToLocalStorage();
                this.render();
            },

            saveCurrentValidation() {
                if (this.selectedFile === null || this.selectedValidation === null) return;

                const file = this.config.files[this.selectedFile];
                const validation = file.validations[this.selectedValidation];
                const valDef = this.validationLibrary[validation.type];

                // Update severity
                validation.severity = document.getElementById('edit-severity').value;

                // Update params
                validation.params = {};
                valDef.params.forEach(param => {
                    const el = document.getElementById(`edit-param-${param.name}`);
                    if (el) {
                        if (param.type === 'checkbox') {
                            validation.params[param.name] = el.checked;
                        } else if (param.type === 'number') {
                            const val = el.value;
                            if (val !== '') {
                                validation.params[param.name] = parseFloat(val);
                            }
                        } else {
                            const val = el.value;
                            if (val !== '') {
                                validation.params[param.name] = val;
                            }
                        }
                    }
                });

                // Update condition
                const condition = document.getElementById('edit-condition').value;
                if (condition) {
                    validation.condition = condition;
                } else {
                    delete validation.condition;
                }

                this.saveToLocalStorage();
                this.render();
            },

            deleteCurrentValidation() {
                if (this.selectedFile === null || this.selectedValidation === null) return;

                if (confirm('Are you sure you want to delete this validation?')) {
                    const file = this.config.files[this.selectedFile];
                    file.validations.splice(this.selectedValidation, 1);
                    this.selectedValidation = null;
                    this.saveToLocalStorage();
                    this.render();
                }
            },

            /* ====================================================================
               Validation Reordering and Duplication
               ====================================================================

               These methods provide functionality to:
               - Duplicate validations (with deep copy of all parameters)
               - Move validations up and down within a file
               - Drag and drop reordering for validations
               - Context menu for quick actions
               - Touch support for mobile devices
            */

            /**
             * Duplicates a validation with all its parameters
             * Creates a deep copy to ensure no reference sharing
             * Inserts the duplicate immediately after the original
             * Auto-selects the duplicated validation for editing
             *
             * @param {number} fileIndex - Index of the file containing the validation
             * @param {number} validationIndex - Index of the validation to duplicate
             */
            duplicateValidation(fileIndex, validationIndex) {
                // Validate indices
                if (fileIndex < 0 || fileIndex >= this.config.files.length) {
                    console.error('Invalid file index:', fileIndex);
                    return;
                }

                const file = this.config.files[fileIndex];
                if (!file.validations || validationIndex < 0 || validationIndex >= file.validations.length) {
                    console.error('Invalid validation index:', validationIndex);
                    return;
                }

                // Get the validation to duplicate
                const originalValidation = file.validations[validationIndex];

                // Create a deep copy using JSON parse/stringify
                // This ensures all nested objects and arrays are properly copied
                const duplicatedValidation = JSON.parse(JSON.stringify(originalValidation));

                // Insert the duplicate immediately after the original
                file.validations.splice(validationIndex + 1, 0, duplicatedValidation);

                // Update the UI
                this.renderFileTree();

                // Select the duplicated validation
                this.selectedFile = fileIndex;
                this.selectedValidation = validationIndex + 1;

                // Update YAML and save state
                this.updateYAMLEditor();
                this.saveToLocalStorage();
                this.render();

                // Add pulse animation to the duplicated item
                setTimeout(() => {
                    const validationItems = document.querySelectorAll('.validation-item');
                    const duplicatedItem = validationItems[validationIndex + 1];
                    if (duplicatedItem) {
                        duplicatedItem.classList.add('just-duplicated');
                        // Scroll into view if needed
                        duplicatedItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        // Remove animation class after animation completes
                        setTimeout(() => {
                            duplicatedItem.classList.remove('just-duplicated');
                        }, 600);
                    }
                }, 100);

                // Show success notification (if notification system exists)
                console.log('Validation duplicated successfully');
            },

            /**
             * Moves a validation up one position in the list
             * Updates YAML and saves state after move
             *
             * @param {number} fileIndex - Index of the file containing the validation
             * @param {number} validationIndex - Index of the validation to move
             */
            moveValidationUp(fileIndex, validationIndex) {
                // Can't move the first item up
                if (validationIndex <= 0) return;

                const file = this.config.files[fileIndex];
                if (!file.validations) return;

                // Swap with previous item
                const temp = file.validations[validationIndex];
                file.validations[validationIndex] = file.validations[validationIndex - 1];
                file.validations[validationIndex - 1] = temp;

                // Update selection to follow the moved item
                if (this.selectedFile === fileIndex && this.selectedValidation === validationIndex) {
                    this.selectedValidation = validationIndex - 1;
                }

                // Update UI and save
                this.updateYAMLEditor();
                this.saveToLocalStorage();
                this.render();
            },

            /**
             * Moves a validation down one position in the list
             * Updates YAML and saves state after move
             *
             * @param {number} fileIndex - Index of the file containing the validation
             * @param {number} validationIndex - Index of the validation to move
             */
            moveValidationDown(fileIndex, validationIndex) {
                const file = this.config.files[fileIndex];
                if (!file.validations) return;

                // Can't move the last item down
                if (validationIndex >= file.validations.length - 1) return;

                // Swap with next item
                const temp = file.validations[validationIndex];
                file.validations[validationIndex] = file.validations[validationIndex + 1];
                file.validations[validationIndex + 1] = temp;

                // Update selection to follow the moved item
                if (this.selectedFile === fileIndex && this.selectedValidation === validationIndex) {
                    this.selectedValidation = validationIndex + 1;
                }

                // Update UI and save
                this.updateYAMLEditor();
                this.saveToLocalStorage();
                this.render();
            },

            /* ====================================================================
               Drag and Drop - Validations
               ==================================================================== */

            /**
             * Handles the start of a validation drag operation
             * Stores drag state and adds visual feedback
             */
            handleValidationDragStart(event, fileIndex, validationIndex) {
                // Store drag data
                this.dragState = {
                    type: 'validation',
                    fileIndex: fileIndex,
                    validationIndex: validationIndex
                };

                // Set drag image (the element being dragged)
                event.dataTransfer.effectAllowed = 'move';
                event.dataTransfer.setData('text/html', event.target.innerHTML);

                // Add dragging class for visual feedback
                event.target.classList.add('dragging');
            },

            /**
             * Handles drag over event for validations
             * Determines drop position and shows visual indicator
             */
            handleValidationDragOver(event) {
                event.preventDefault();
                event.stopPropagation();

                // Only allow validation drops
                if (!this.dragState || this.dragState.type !== 'validation') return;

                event.dataTransfer.dropEffect = 'move';

                // Get the target validation item
                const target = event.currentTarget;
                const rect = target.getBoundingClientRect();
                const midpoint = rect.top + rect.height / 2;

                // Remove previous indicators
                document.querySelectorAll('.validation-item').forEach(item => {
                    item.classList.remove('drag-over-top', 'drag-over-bottom');
                });

                // Add indicator based on mouse position
                if (event.clientY < midpoint) {
                    target.classList.add('drag-over-top');
                } else {
                    target.classList.add('drag-over-bottom');
                }
            },

            /**
             * Handles drop event for validations
             * Performs the actual reordering
             */
            handleValidationDrop(event, targetFileIndex, targetValidationIndex) {
                event.preventDefault();
                event.stopPropagation();

                if (!this.dragState || this.dragState.type !== 'validation') return;

                const sourceFileIndex = this.dragState.fileIndex;
                const sourceValidationIndex = this.dragState.validationIndex;

                // Can only reorder within the same file
                if (sourceFileIndex !== targetFileIndex) return;

                // Don't do anything if dropping on itself
                if (sourceValidationIndex === targetValidationIndex) return;

                const file = this.config.files[sourceFileIndex];

                // Determine actual drop position based on visual indicator
                const target = event.currentTarget;
                const rect = target.getBoundingClientRect();
                const midpoint = rect.top + rect.height / 2;
                let newIndex = targetValidationIndex;

                if (event.clientY >= midpoint) {
                    // Drop below target
                    newIndex = targetValidationIndex + 1;
                }

                // Adjust for removal of source item
                if (sourceValidationIndex < newIndex) {
                    newIndex--;
                }

                // Perform the move
                const validation = file.validations.splice(sourceValidationIndex, 1)[0];
                file.validations.splice(newIndex, 0, validation);

                // Update selection to follow moved item
                if (this.selectedFile === sourceFileIndex && this.selectedValidation === sourceValidationIndex) {
                    this.selectedValidation = newIndex;
                }

                // Update UI and save
                this.updateYAMLEditor();
                this.saveToLocalStorage();
                this.render();
            },

            /**
             * Handles the end of a validation drag operation
             * Cleans up visual feedback
             */
            handleValidationDragEnd(event) {
                // Remove visual feedback
                event.target.classList.remove('dragging');
                document.querySelectorAll('.validation-item').forEach(item => {
                    item.classList.remove('drag-over-top', 'drag-over-bottom');
                });

                // Clear drag state
                this.dragState = null;
            },

            /* ====================================================================
               Drag and Drop - Files
               ==================================================================== */

            /**
             * Handles the start of a file drag operation
             */
            handleFileDragStart(event, fileIndex) {
                this.dragState = {
                    type: 'file',
                    fileIndex: fileIndex
                };

                event.dataTransfer.effectAllowed = 'move';
                event.dataTransfer.setData('text/html', event.target.innerHTML);
                event.target.classList.add('dragging');
            },

            /**
             * Handles drag over event for files
             */
            handleFileDragOver(event) {
                event.preventDefault();
                event.stopPropagation();

                if (!this.dragState || this.dragState.type !== 'file') return;

                event.dataTransfer.dropEffect = 'move';

                const target = event.currentTarget;
                const rect = target.getBoundingClientRect();
                const midpoint = rect.top + rect.height / 2;

                // Remove previous indicators
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('drag-over-top', 'drag-over-bottom');
                });

                // Add indicator based on mouse position
                if (event.clientY < midpoint) {
                    target.classList.add('drag-over-top');
                } else {
                    target.classList.add('drag-over-bottom');
                }
            },

            /**
             * Handles drop event for files
             */
            handleFileDrop(event, targetFileIndex) {
                event.preventDefault();
                event.stopPropagation();

                if (!this.dragState || this.dragState.type !== 'file') return;

                const sourceFileIndex = this.dragState.fileIndex;

                if (sourceFileIndex === targetFileIndex) return;

                // Determine drop position
                const target = event.currentTarget;
                const rect = target.getBoundingClientRect();
                const midpoint = rect.top + rect.height / 2;
                let newIndex = targetFileIndex;

                if (event.clientY >= midpoint) {
                    newIndex = targetFileIndex + 1;
                }

                // Adjust for removal
                if (sourceFileIndex < newIndex) {
                    newIndex--;
                }

                // Perform the move
                const file = this.config.files.splice(sourceFileIndex, 1)[0];
                this.config.files.splice(newIndex, 0, file);

                // Update selection to follow moved file
                if (this.selectedFile === sourceFileIndex) {
                    this.selectedFile = newIndex;
                }

                // Update UI and save
                this.updateYAMLEditor();
                this.saveToLocalStorage();
                this.render();
            },

            /**
             * Handles the end of a file drag operation
             */
            handleFileDragEnd(event) {
                event.target.classList.remove('dragging');
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('drag-over-top', 'drag-over-bottom');
                });
                this.dragState = null;
            },

            /* ====================================================================
               Touch Support for Mobile Drag and Drop
               ==================================================================== */

            /**
             * Handles touch start for mobile drag
             */
            handleValidationTouchStart(event, fileIndex, validationIndex) {
                this.touchState = {
                    fileIndex: fileIndex,
                    validationIndex: validationIndex,
                    startY: event.touches[0].clientY,
                    element: event.currentTarget,
                    longPressTimer: setTimeout(() => {
                        // Long press detected - enter drag mode
                        this.touchState.dragging = true;
                        event.currentTarget.classList.add('dragging');
                        // Haptic feedback if available
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                    }, 500) // 500ms long press
                };
            },

            /**
             * Handles touch move for mobile drag
             */
            handleValidationTouchMove(event) {
                if (!this.touchState) return;

                // Cancel long press if user moves too much before timer
                if (!this.touchState.dragging && this.touchState.longPressTimer) {
                    const deltaY = Math.abs(event.touches[0].clientY - this.touchState.startY);
                    if (deltaY > 10) {
                        clearTimeout(this.touchState.longPressTimer);
                        this.touchState = null;
                        return;
                    }
                }

                if (!this.touchState.dragging) return;

                event.preventDefault();

                // Find element under touch
                const touch = event.touches[0];
                const elementUnder = document.elementFromPoint(touch.clientX, touch.clientY);
                const validationItem = elementUnder?.closest('.validation-item');

                if (validationItem && validationItem !== this.touchState.element) {
                    // Show drop indicator
                    document.querySelectorAll('.validation-item').forEach(item => {
                        item.classList.remove('drag-over-top', 'drag-over-bottom');
                    });

                    const rect = validationItem.getBoundingClientRect();
                    const midpoint = rect.top + rect.height / 2;

                    if (touch.clientY < midpoint) {
                        validationItem.classList.add('drag-over-top');
                    } else {
                        validationItem.classList.add('drag-over-bottom');
                    }

                    this.touchState.targetElement = validationItem;
                }
            },

            /**
             * Handles touch end for mobile drag
             */
            handleValidationTouchEnd(event) {
                if (!this.touchState) return;

                // Clear long press timer
                if (this.touchState.longPressTimer) {
                    clearTimeout(this.touchState.longPressTimer);
                }

                if (this.touchState.dragging && this.touchState.targetElement) {
                    // Perform drop
                    const sourceFileIndex = this.touchState.fileIndex;
                    const sourceValidationIndex = this.touchState.validationIndex;
                    const targetFileIndex = parseInt(this.touchState.targetElement.dataset.fileIndex);
                    const targetValidationIndex = parseInt(this.touchState.targetElement.dataset.validationIndex);

                    if (sourceFileIndex === targetFileIndex && sourceValidationIndex !== targetValidationIndex) {
                        const file = this.config.files[sourceFileIndex];
                        const validation = file.validations.splice(sourceValidationIndex, 1)[0];

                        let newIndex = targetValidationIndex;
                        if (sourceValidationIndex < newIndex) {
                            newIndex--;
                        }

                        file.validations.splice(newIndex, 0, validation);

                        this.updateYAMLEditor();
                        this.saveToLocalStorage();
                        this.render();
                    }
                }

                // Clean up
                if (this.touchState.element) {
                    this.touchState.element.classList.remove('dragging');
                }
                document.querySelectorAll('.validation-item').forEach(item => {
                    item.classList.remove('drag-over-top', 'drag-over-bottom');
                });
                this.touchState = null;
            },

            /* ====================================================================
               Context Menu
               ==================================================================== */

            /**
             * Shows context menu for validation items
             * Provides quick access to common actions
             */
            showValidationContextMenu(event, fileIndex, validationIndex) {
                event.preventDefault();
                event.stopPropagation();

                // Remove any existing context menu
                const existingMenu = document.querySelector('.context-menu');
                if (existingMenu) {
                    existingMenu.remove();
                }

                const file = this.config.files[fileIndex];
                const isFirst = validationIndex === 0;
                const isLast = validationIndex === file.validations.length - 1;

                // Create context menu
                const menu = document.createElement('div');
                menu.className = 'context-menu';
                menu.style.top = event.clientY + 'px';
                menu.style.left = event.clientX + 'px';

                menu.innerHTML = `
                    <div class="context-menu-item ${isFirst ? 'disabled' : ''}"
                         onclick="${isFirst ? '' : `app.moveValidationUp(${fileIndex}, ${validationIndex}); this.closest('.context-menu').remove();`}">
                        â†‘ Move Up
                    </div>
                    <div class="context-menu-item ${isLast ? 'disabled' : ''}"
                         onclick="${isLast ? '' : `app.moveValidationDown(${fileIndex}, ${validationIndex}); this.closest('.context-menu').remove();`}">
                        â†“ Move Down
                    </div>
                    <div class="context-menu-divider"></div>
                    <div class="context-menu-item"
                         onclick="app.duplicateValidation(${fileIndex}, ${validationIndex}); this.closest('.context-menu').remove();">
                        ðŸ“‹ Duplicate
                    </div>
                    <div class="context-menu-item"
                         onclick="app.selectValidation(${fileIndex}, ${validationIndex}); this.closest('.context-menu').remove();">
                        âœï¸ Edit
                    </div>
                    <div class="context-menu-divider"></div>
                    <div class="context-menu-item danger"
                         onclick="if(confirm('Delete this validation?')) { app.config.files[${fileIndex}].validations.splice(${validationIndex}, 1); app.updateYAMLEditor(); app.saveToLocalStorage(); app.render(); } this.closest('.context-menu').remove();">
                        ðŸ—‘ï¸ Delete
                    </div>
                `;

                document.body.appendChild(menu);

                // Position adjustment if menu goes off screen
                const rect = menu.getBoundingClientRect();
                if (rect.right > window.innerWidth) {
                    menu.style.left = (window.innerWidth - rect.width - 10) + 'px';
                }
                if (rect.bottom > window.innerHeight) {
                    menu.style.top = (window.innerHeight - rect.height - 10) + 'px';
                }

                // Close on click outside
                setTimeout(() => {
                    const closeMenu = (e) => {
                        if (!menu.contains(e.target)) {
                            menu.remove();
                            document.removeEventListener('click', closeMenu);
                        }
                    };
                    document.addEventListener('click', closeMenu);
                }, 100);
            },

            /* ====================================================================
               Import/Export
               ==================================================================== */

            openImportDialog() {
                this.openModal('import-modal');
                document.getElementById('import-yaml-text').value = '';
            },

            importYAML() {
                const yamlText = document.getElementById('import-yaml-text').value;

                // For production, use a proper YAML parser like js-yaml
                // This is a simplified implementation
                alert('YAML import requires js-yaml library. For now, use the wizard to create projects.');

                this.closeModal('import-modal');
            },

            exportYAML() {
                const yaml = this.generateYAML();
                const blob = new Blob([yaml], { type: 'text/yaml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.config.validation_job.name || 'validation'}.yaml`;
                a.click();
                URL.revokeObjectURL(url);
            },

            copyYAML() {
                const yaml = this.generateYAML();
                navigator.clipboard.writeText(yaml).then(() => {
                    alert('YAML copied to clipboard!');
                });
            },

            formatYAML() {
                // Regenerate YAML (already formatted)
                this.updateYAMLEditor();
            },

            /* ====================================================================
               Catalog
               ==================================================================== */

            openCatalog() {
                this.openModal('catalog-modal');
                this.renderValidationCatalog('catalog');
            },

            /* ====================================================================
               Modal Management
               ==================================================================== */

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            },

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            },

            /* ====================================================================
               Menu Actions
               ==================================================================== */

            showMenu(menu) {
                // Placeholder for menu functionality
                console.log(`Menu ${menu} clicked`);
            },

            showAbout() {
                this.openModal('about-modal');
            },

            /* ====================================================================
               LocalStorage Persistence
               ==================================================================== */

            saveToLocalStorage() {
                try {
                    localStorage.setItem('datak9-config', JSON.stringify(this.config));
                    console.log('Configuration saved to localStorage');
                } catch (e) {
                    console.error('Failed to save to localStorage:', e);
                }
            },

            loadFromLocalStorage() {
                try {
                    const saved = localStorage.getItem('datak9-config');
                    if (saved) {
                        this.config = JSON.parse(saved);
                        console.log('Configuration loaded from localStorage');
                    }
                } catch (e) {
                    console.error('Failed to load from localStorage:', e);
                }
            }
        };

        /* ========================================================================
           Panel Manager - Resizable, Collapsible, Responsive Panels
           ========================================================================

           This object manages all panel resize, collapse, and mobile functionality:
           - Drag-to-resize panels with min/max constraints
           - Collapse/expand panels with smooth animations
           - Mobile responsive layout with drawer/modal panels
           - LocalStorage persistence of panel states
           - Keyboard shortcuts for panel toggles
           - Touch support for mobile devices

           Author: Daniel Edge
           Version: 2.0.0
        */
        const panelManager = {
            // Panel size constraints (in pixels)
            constraints: {
                sidebar: { min: 200, max: 600, default: 280 },
                helpPanel: { min: 250, max: 600, default: 320 },
                bottomPanel: { min: 150, max: 400, default: 200 }
            },

            // Current panel sizes (initialized from localStorage or defaults)
            panelSizes: {
                sidebar: 280,
                helpPanel: 320,
                bottomPanel: 200,
                yamlSplit: 50 // Percentage
            },

            // Panel collapsed states
            panelStates: {
                sidebarCollapsed: false,
                helpPanelCollapsed: false,
                bottomPanelCollapsed: false
            },

            // Mobile states
            mobileLayout: {
                sidebarOpen: false,
                helpPanelOpen: false,
                activeTab: 'visual' // 'visual' or 'yaml'
            },

            // Resize tracking
            resizing: {
                active: false,
                panel: null,
                startX: 0,
                startY: 0,
                startSize: 0
            },

            /* ====================================================================
               Initialization
               ==================================================================== */

            init() {
                console.log('Initializing Panel Manager...');

                // Load saved panel states from localStorage
                this.loadPanelState();

                // Apply initial panel sizes
                this.applyPanelSizes();

                // Initialize resize handles
                this.initializeResizeHandles();

                // Initialize keyboard shortcuts
                this.initializeKeyboardShortcuts();

                // Initialize mobile responsive behavior
                this.initializeResponsive();

                console.log('Panel Manager initialized successfully');
            },

            /* ====================================================================
               Panel Resizing
               ==================================================================== */

            initializeResizeHandles() {
                // Sidebar resize handle
                const sidebarHandle = document.querySelector('.resize-handle-sidebar');
                if (sidebarHandle) {
                    this.attachResizeEvents(sidebarHandle, 'sidebar', 'horizontal');
                }

                // Help panel resize handle
                const helpHandle = document.querySelector('.resize-handle-help');
                if (helpHandle) {
                    this.attachResizeEvents(helpHandle, 'helpPanel', 'horizontal');
                }

                // Bottom panel resize handle
                const bottomHandle = document.querySelector('.resize-handle-bottom');
                if (bottomHandle) {
                    this.attachResizeEvents(bottomHandle, 'bottomPanel', 'vertical');
                }

                // Editor split resize handle
                const splitHandle = document.getElementById('split-resize-handle');
                if (splitHandle) {
                    this.attachSplitResizeEvents(splitHandle);
                }
            },

            attachResizeEvents(handle, panelName, direction) {
                // Mouse events
                handle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    this.startResize(e, panelName, direction);
                });

                // Touch events for mobile
                handle.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.startResize(touch, panelName, direction);
                }, { passive: false });
            },

            startResize(e, panelName, direction) {
                this.resizing.active = true;
                this.resizing.panel = panelName;
                this.resizing.direction = direction;
                this.resizing.startX = e.clientX;
                this.resizing.startY = e.clientY;
                this.resizing.startSize = this.panelSizes[panelName];

                // Add resizing class for visual feedback
                const handle = e.target;
                handle.classList.add('resizing');

                // Prevent text selection during resize
                document.body.style.userSelect = 'none';

                // Attach move and end events
                document.addEventListener('mousemove', this.handleResize);
                document.addEventListener('mouseup', this.endResize);
                document.addEventListener('touchmove', this.handleResizeTouch, { passive: false });
                document.addEventListener('touchend', this.endResize);
            },

            handleResize: (e) => {
                if (!panelManager.resizing.active) return;

                const { panel, direction, startX, startY, startSize } = panelManager.resizing;

                let delta = 0;
                if (direction === 'horizontal') {
                    delta = panel === 'sidebar' ? (e.clientX - startX) : (startX - e.clientX);
                } else {
                    delta = startY - e.clientY;
                }

                const newSize = Math.max(
                    panelManager.constraints[panel].min,
                    Math.min(panelManager.constraints[panel].max, startSize + delta)
                );

                panelManager.panelSizes[panel] = newSize;
                panelManager.applyPanelSize(panel, newSize);
            },

            handleResizeTouch: (e) => {
                if (!panelManager.resizing.active) return;
                e.preventDefault();

                const touch = e.touches[0];
                panelManager.handleResize(touch);
            },

            endResize: () => {
                if (!panelManager.resizing.active) return;

                // Remove resizing class
                const handles = document.querySelectorAll('.resize-handle.resizing, .resize-handle-split.resizing');
                handles.forEach(h => h.classList.remove('resizing'));

                // Re-enable text selection
                document.body.style.userSelect = '';

                // Save panel state to localStorage
                panelManager.savePanelState();

                // Clean up
                document.removeEventListener('mousemove', panelManager.handleResize);
                document.removeEventListener('mouseup', panelManager.endResize);
                document.removeEventListener('touchmove', panelManager.handleResizeTouch);
                document.removeEventListener('touchend', panelManager.endResize);

                panelManager.resizing.active = false;
                panelManager.resizing.panel = null;
            },

            attachSplitResizeEvents(handle) {
                let startX = 0;
                let startWidth = 0;
                let visualEditor = null;
                let yamlEditor = null;

                const startSplitResize = (e) => {
                    e.preventDefault();
                    visualEditor = document.getElementById('visual-editor');
                    yamlEditor = document.getElementById('yaml-editor-panel');

                    if (!visualEditor || !yamlEditor) return;

                    startX = e.clientX;
                    const editorView = document.getElementById('editor-view');
                    const totalWidth = editorView.offsetWidth;
                    startWidth = visualEditor.offsetWidth;

                    handle.classList.add('resizing');
                    document.body.style.userSelect = 'none';

                    document.addEventListener('mousemove', handleSplitMove);
                    document.addEventListener('mouseup', endSplitResize);
                };

                const handleSplitMove = (e) => {
                    if (!visualEditor || !yamlEditor) return;

                    const editorView = document.getElementById('editor-view');
                    const totalWidth = editorView.offsetWidth;
                    const delta = e.clientX - startX;
                    const newWidth = startWidth + delta;

                    // Calculate percentage (30% to 70% range)
                    const percentage = (newWidth / totalWidth) * 100;
                    const clampedPercentage = Math.max(30, Math.min(70, percentage));

                    visualEditor.style.flex = `0 0 ${clampedPercentage}%`;
                    yamlEditor.style.flex = `0 0 ${100 - clampedPercentage}%`;

                    panelManager.panelSizes.yamlSplit = clampedPercentage;
                };

                const endSplitResize = () => {
                    handle.classList.remove('resizing');
                    document.body.style.userSelect = '';

                    document.removeEventListener('mousemove', handleSplitMove);
                    document.removeEventListener('mouseup', endSplitResize);

                    panelManager.savePanelState();
                };

                handle.addEventListener('mousedown', startSplitResize);

                // Touch support
                handle.addEventListener('touchstart', (e) => {
                    const touch = e.touches[0];
                    startSplitResize(touch);
                }, { passive: false });
            },

            applyPanelSizes() {
                this.applyPanelSize('sidebar', this.panelSizes.sidebar);
                this.applyPanelSize('helpPanel', this.panelSizes.helpPanel);
                this.applyPanelSize('bottomPanel', this.panelSizes.bottomPanel);

                // Apply split percentage
                const visualEditor = document.getElementById('visual-editor');
                const yamlEditor = document.getElementById('yaml-editor-panel');
                if (visualEditor && yamlEditor) {
                    const splitPercent = this.panelSizes.yamlSplit;
                    visualEditor.style.flex = `0 0 ${splitPercent}%`;
                    yamlEditor.style.flex = `0 0 ${100 - splitPercent}%`;
                }
            },

            applyPanelSize(panelName, size) {
                let element = null;
                let property = 'width';

                if (panelName === 'sidebar') {
                    element = document.getElementById('sidebar');
                } else if (panelName === 'helpPanel') {
                    element = document.getElementById('help-panel');
                } else if (panelName === 'bottomPanel') {
                    element = document.getElementById('bottom-panel');
                    property = 'height';
                }

                if (element && !this.panelStates[panelName + 'Collapsed']) {
                    element.style[property] = size + 'px';
                }
            },

            /* ====================================================================
               Panel Collapse/Expand
               ==================================================================== */

            togglePanel(panelId) {
                const panel = document.getElementById(panelId);
                if (!panel) return;

                const isCollapsed = panel.classList.contains('collapsed');

                if (isCollapsed) {
                    this.expandPanel(panelId);
                } else {
                    this.collapsePanel(panelId);
                }

                // Save state
                this.savePanelState();

                // Announce to screen readers
                const action = isCollapsed ? 'expanded' : 'collapsed';
                console.log(`Panel ${panelId} ${action}`);
            },

            collapsePanel(panelId) {
                const panel = document.getElementById(panelId);
                if (!panel) return;

                panel.classList.add('collapsed');

                // Update state
                if (panelId === 'sidebar') {
                    this.panelStates.sidebarCollapsed = true;
                } else if (panelId === 'help-panel') {
                    this.panelStates.helpPanelCollapsed = true;
                } else if (panelId === 'bottom-panel') {
                    this.panelStates.bottomPanelCollapsed = true;
                }
            },

            expandPanel(panelId) {
                const panel = document.getElementById(panelId);
                if (!panel) return;

                panel.classList.remove('collapsed');

                // Restore size
                if (panelId === 'sidebar') {
                    this.panelStates.sidebarCollapsed = false;
                    this.applyPanelSize('sidebar', this.panelSizes.sidebar);
                } else if (panelId === 'help-panel') {
                    this.panelStates.helpPanelCollapsed = false;
                    this.applyPanelSize('helpPanel', this.panelSizes.helpPanel);
                } else if (panelId === 'bottom-panel') {
                    this.panelStates.bottomPanelCollapsed = false;
                    this.applyPanelSize('bottomPanel', this.panelSizes.bottomPanel);
                }
            },

            /* ====================================================================
               Keyboard Shortcuts
               ==================================================================== */

            initializeKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+B - Toggle sidebar
                    if (e.ctrlKey && e.key === 'b') {
                        e.preventDefault();
                        this.togglePanel('sidebar');
                    }

                    // Ctrl+H - Toggle help panel
                    if (e.ctrlKey && e.key === 'h') {
                        e.preventDefault();
                        this.togglePanel('help-panel');
                    }

                    // Ctrl+J - Toggle bottom panel
                    if (e.ctrlKey && e.key === 'j') {
                        e.preventDefault();
                        this.togglePanel('bottom-panel');
                    }
                });
            },

            /* ====================================================================
               Mobile Responsive
               ==================================================================== */

            initializeResponsive() {
                // Listen for window resize to handle responsive breakpoints
                window.addEventListener('resize', () => {
                    this.handleResponsiveLayout();
                });

                // Initial layout setup
                this.handleResponsiveLayout();
            },

            handleResponsiveLayout() {
                const isMobile = window.innerWidth < 768;

                if (isMobile) {
                    // Apply mobile layout
                    this.applyMobileLayout();
                } else {
                    // Apply desktop layout
                    this.applyDesktopLayout();
                }
            },

            applyMobileLayout() {
                // Close any open mobile panels
                this.closeMobilePanels();

                // Ensure correct mobile tab is active
                this.updateMobileTabs();
            },

            applyDesktopLayout() {
                // Remove mobile classes
                const sidebar = document.getElementById('sidebar');
                const helpPanel = document.getElementById('help-panel');
                const overlay = document.getElementById('sidebar-overlay');

                if (sidebar) sidebar.classList.remove('mobile-open');
                if (helpPanel) helpPanel.classList.remove('mobile-open');
                if (overlay) overlay.classList.remove('active');

                // Show both visual and YAML editors
                const visualEditor = document.getElementById('visual-editor');
                const yamlPanel = document.getElementById('yaml-editor-panel');

                if (visualEditor) visualEditor.classList.remove('mobile-active');
                if (yamlPanel) yamlPanel.classList.remove('mobile-active');

                // Apply saved panel sizes
                this.applyPanelSizes();
            },

            toggleMobileSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');

                if (!sidebar || !overlay) return;

                const isOpen = sidebar.classList.contains('mobile-open');

                if (isOpen) {
                    sidebar.classList.remove('mobile-open');
                    overlay.classList.remove('active');
                    this.mobileLayout.sidebarOpen = false;
                } else {
                    sidebar.classList.add('mobile-open');
                    overlay.classList.add('active');
                    this.mobileLayout.sidebarOpen = true;
                }
            },

            toggleMobileHelp() {
                const helpPanel = document.getElementById('help-panel');
                const overlay = document.getElementById('sidebar-overlay');

                if (!helpPanel || !overlay) return;

                const isOpen = helpPanel.classList.contains('mobile-open');

                if (isOpen) {
                    helpPanel.classList.remove('mobile-open');
                    overlay.classList.remove('active');
                    this.mobileLayout.helpPanelOpen = false;
                } else {
                    helpPanel.classList.add('mobile-open');
                    overlay.classList.add('active');
                    this.mobileLayout.helpPanelOpen = true;
                }
            },

            closeMobilePanels() {
                const sidebar = document.getElementById('sidebar');
                const helpPanel = document.getElementById('help-panel');
                const overlay = document.getElementById('sidebar-overlay');

                if (sidebar) sidebar.classList.remove('mobile-open');
                if (helpPanel) helpPanel.classList.remove('mobile-open');
                if (overlay) overlay.classList.remove('active');

                this.mobileLayout.sidebarOpen = false;
                this.mobileLayout.helpPanelOpen = false;
            },

            switchMobileTab(tab) {
                const visualEditor = document.getElementById('visual-editor');
                const yamlPanel = document.getElementById('yaml-editor-panel');
                const visualBtn = document.querySelector('.mobile-tab-btn[data-tab="visual"]');
                const yamlBtn = document.querySelector('.mobile-tab-btn[data-tab="yaml"]');

                if (!visualEditor || !yamlPanel) return;

                // Update active tab
                this.mobileLayout.activeTab = tab;

                // Update tab buttons
                if (visualBtn) visualBtn.classList.toggle('active', tab === 'visual');
                if (yamlBtn) yamlBtn.classList.toggle('active', tab === 'yaml');

                // Update editor visibility
                visualEditor.classList.toggle('mobile-active', tab === 'visual');
                yamlPanel.classList.toggle('mobile-active', tab === 'yaml');

                // Save state
                this.savePanelState();
            },

            updateMobileTabs() {
                const activeTab = this.mobileLayout.activeTab;
                this.switchMobileTab(activeTab);
            },

            /* ====================================================================
               LocalStorage Persistence
               ==================================================================== */

            savePanelState() {
                try {
                    const state = {
                        panelSizes: this.panelSizes,
                        panelStates: this.panelStates,
                        mobileLayout: this.mobileLayout
                    };
                    localStorage.setItem('datak9-panel-state', JSON.stringify(state));
                    console.log('Panel state saved to localStorage');
                } catch (e) {
                    console.error('Failed to save panel state:', e);
                }
            },

            loadPanelState() {
                try {
                    const saved = localStorage.getItem('datak9-panel-state');
                    if (saved) {
                        const state = JSON.parse(saved);

                        // Restore panel sizes
                        if (state.panelSizes) {
                            this.panelSizes = { ...this.panelSizes, ...state.panelSizes };
                        }

                        // Restore panel states
                        if (state.panelStates) {
                            this.panelStates = { ...this.panelStates, ...state.panelStates };

                            // Apply collapsed states
                            if (state.panelStates.sidebarCollapsed) {
                                setTimeout(() => this.collapsePanel('sidebar'), 100);
                            }
                            if (state.panelStates.helpPanelCollapsed) {
                                setTimeout(() => this.collapsePanel('help-panel'), 100);
                            }
                            if (state.panelStates.bottomPanelCollapsed) {
                                setTimeout(() => this.collapsePanel('bottom-panel'), 100);
                            }
                        }

                        // Restore mobile layout
                        if (state.mobileLayout) {
                            this.mobileLayout = { ...this.mobileLayout, ...state.mobileLayout };
                        }

                        console.log('Panel state loaded from localStorage');
                    }
                } catch (e) {
                    console.error('Failed to load panel state:', e);
                }
            }
        };

        // Initialize the application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
            panelManager.init();
        });
    </script>
</body>
</html>